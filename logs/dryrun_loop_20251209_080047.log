[2025-12-09 08:00:48] [WARNING] exchange_api: [ExchangeAPI] config.SYMBOL=BTC/USDT:USDT Ïù¥ÏßÄÎßå, v10.1 Î™ÖÏÑ∏Ïóê Îî∞Îùº BTCUSDT Î°ú Í≥†Ï†ïÌï©ÎãàÎã§.
[2025-12-09 08:00:48] [WARNING] exchange_api: üß™ [DRY_RUN] Î™®ÎìúÎ°ú ExchangeAPI Ï¥àÍ∏∞Ìôî (Ïã§ Í±∞Îûò ÏóÜÏùå)
[2025-12-09 08:00:48] [WARNING] state_manager: BotState JSON Ïä§ÌÇ§Îßà Ï∞®Ïù¥ Í∞êÏßÄ (missing=set(), extra={'startup_done'}) ‚Üí Ìò∏Ìôò Î™®ÎìúÎ°ú Î°úÎìúÌï©ÎãàÎã§.
[2025-12-09 08:00:48] [INFO] state_manager: BotState Î°úÎìú: mode=NORMAL wave_id=27413 p_center=91702.4 p_gap=206.7389285714285
[2025-12-09 08:00:48] [INFO] escape_config: [escape_config] YAML loaded but no value changes detected.
[2025-12-09 08:00:48] [WARNING] state_manager: BotState JSON Ïä§ÌÇ§Îßà Ï∞®Ïù¥ Í∞êÏßÄ (missing=set(), extra={'startup_done'}) ‚Üí Ìò∏Ìôò Î™®ÎìúÎ°ú Î°úÎìúÌï©ÎãàÎã§.
[2025-12-09 08:00:48] [INFO] state_manager: BotState Î°úÎìú: mode=NORMAL wave_id=27413 p_center=91702.4 p_gap=206.7389285714285
[2025-12-09 08:00:48] [INFO] main_v10: WaveBot v10.1 starting...
[2025-12-09 08:00:48] [INFO] exchange_api: [ExchangeAPI] DRY_RUN - set_leverage_and_mode Ïä§ÌÇµ
[2025-12-09 08:00:48] [INFO] main_v10: WaveBot v10.1 main loop started (interval=1.000s)
[2025-12-09 08:00:49] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90460', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90460.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90460', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90460.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:00:49] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:00:49] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:00:49] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90460', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90460.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90460', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90460.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:00:49] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:00:49] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=1
[2025-12-09 08:00:49] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:00:49] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:00:51] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90460', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90460.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90460', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90460.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:00:51] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:00:51] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:00:51] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90460', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90460.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90460', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90460.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:00:51] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:00:51] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=2
[2025-12-09 08:00:51] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:00:51] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:00:51] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:00:51] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:00:51] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:00:52] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90459.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90459.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90459.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90459.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:00:52] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:00:52] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:00:52] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90459.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90459.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90459.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90459.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:00:52] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:00:52] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=3
[2025-12-09 08:00:52] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:00:52] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:00:52] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:00:52] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:00:52] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:00:53] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90460', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90460.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90460', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90460.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:00:53] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:00:53] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:00:54] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90460', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90460.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90460', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90460.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:00:54] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:00:54] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=4
[2025-12-09 08:00:54] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:00:54] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:00:54] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:00:54] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:00:54] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:00:55] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90459.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90459.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90459.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90459.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:00:55] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:00:55] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:00:55] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90459.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90459.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90459.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90459.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:00:55] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:00:55] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=5
[2025-12-09 08:00:55] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:00:55] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:00:55] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:00:55] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:00:55] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:00:56] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90459.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90459.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90459.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90459.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:00:56] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:00:56] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:00:56] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90459.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90459.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90459.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90459.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:00:56] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:00:56] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=6
[2025-12-09 08:00:57] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:00:57] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:00:57] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:00:57] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:00:57] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:00:58] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90459.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90459.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90459.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90459.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:00:58] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:00:58] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:00:58] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90459.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90459.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90459.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90459.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:00:58] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:00:58] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=7
[2025-12-09 08:00:58] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:00:58] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:00:58] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:00:58] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:00:58] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:00:59] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90456.77', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90456.77, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90456.77', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90456.77, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:00:59] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:00:59] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:00:59] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90443.72', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90443.72, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90443.72', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90443.72, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:00:59] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:00:59] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=8
[2025-12-09 08:00:59] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:00:59] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:00:59] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:00:59] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:00:59] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:01] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90441.99', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90441.99, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90441.99', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90441.99, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:01] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:01] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:01] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90441.99', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90441.99, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90441.99', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90441.99, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:01] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:01] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=9
[2025-12-09 08:01:01] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:01] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:01] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:01] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:01] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:02] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90442.02', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90442.02, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90442.02', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90442.02, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:02] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:02] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:02] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90442.02', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90442.02, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90442.02', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90442.02, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:02] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:02] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=10
[2025-12-09 08:01:02] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:02] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:02] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:02] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:02] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:04] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90439.43', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90439.43, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90439.43', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90439.43, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:04] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:04] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:04] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90439.43', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90439.43, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90439.43', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90439.43, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:04] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:04] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=11
[2025-12-09 08:01:04] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:04] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:04] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:04] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:04] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:05] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90440.64', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90440.64, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90440.64', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90440.64, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:05] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:05] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:05] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90441.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90441.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90441.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90441.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:05] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:05] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=12
[2025-12-09 08:01:05] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:05] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:05] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:05] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:05] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:07] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90441.43', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90441.43, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90441.43', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90441.43, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:07] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:07] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:07] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90441.43', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90441.43, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90441.43', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90441.43, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:07] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:07] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=13
[2025-12-09 08:01:07] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:07] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:07] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:07] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:07] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:08] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90441.43', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90441.43, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90441.43', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90441.43, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:08] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:08] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:08] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90441.43', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90441.43, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90441.43', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90441.43, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:08] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:08] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=14
[2025-12-09 08:01:08] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:08] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:08] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:08] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:08] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:09] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90441.56', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90441.56, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90441.56', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90441.56, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:09] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:09] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:10] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90441.56', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90441.56, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90441.56', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90441.56, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:10] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:10] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=15
[2025-12-09 08:01:10] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:10] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:10] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:10] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:10] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:11] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90441.58', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90441.58, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90441.58', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90441.58, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:11] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:11] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:11] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90441.58', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90441.58, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90441.58', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90441.58, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:11] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:11] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=16
[2025-12-09 08:01:11] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:11] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:11] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:11] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:11] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:12] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90448.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90448.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90448.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90448.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:12] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:12] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:12] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90448.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90448.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90448.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90448.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:12] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:12] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=17
[2025-12-09 08:01:12] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:12] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:12] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:12] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:12] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:14] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90448.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90448.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90448.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90448.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:14] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:14] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:14] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90448.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90448.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90448.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90448.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:14] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:14] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=18
[2025-12-09 08:01:14] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:14] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:14] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:14] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:14] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:15] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90449', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90449.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90449', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90449.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:15] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:15] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:15] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90449', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90449.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90449', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90449.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:15] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:15] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=19
[2025-12-09 08:01:15] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:15] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:15] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:15] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:15] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:17] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90449', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90449.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90449', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90449.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:17] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:17] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:17] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90449', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90449.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90449', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90449.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:17] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:17] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=20
[2025-12-09 08:01:17] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:17] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:17] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:17] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:17] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:18] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90449', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90449.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90449', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90449.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:18] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:18] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:18] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90449', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90449.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90449', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90449.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:18] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:18] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=21
[2025-12-09 08:01:18] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:18] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:18] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:18] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:18] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:20] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90456.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90456.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90456.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90456.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:20] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:20] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:20] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90456.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90456.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90456.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90456.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:20] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:20] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=22
[2025-12-09 08:01:20] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:20] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:20] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:20] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:20] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:21] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90456.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90456.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90456.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90456.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:21] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:21] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:21] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90456.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90456.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90456.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90456.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:21] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:21] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=23
[2025-12-09 08:01:21] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:21] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:21] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:21] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:21] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:23] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:23] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:23] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:23] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:23] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:23] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=24
[2025-12-09 08:01:23] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:23] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:23] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:23] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:23] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:24] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:24] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:24] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:24] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:24] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:24] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=25
[2025-12-09 08:01:24] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:24] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:24] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:24] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:24] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:25] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:25] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:25] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:26] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:26] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:26] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=26
[2025-12-09 08:01:26] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:26] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:26] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:26] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:26] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:27] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:27] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:27] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:27] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:27] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:27] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=27
[2025-12-09 08:01:27] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:27] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:27] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:27] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:27] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:28] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:28] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:28] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:28] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:28] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:28] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=28
[2025-12-09 08:01:28] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:28] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:28] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:28] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:28] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:30] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:30] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:30] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:30] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:30] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:30] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=29
[2025-12-09 08:01:30] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:30] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:30] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:30] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:30] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:31] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:31] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:31] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:31] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:31] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:31] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=30
[2025-12-09 08:01:31] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:31] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:31] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:31] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:31] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:33] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:33] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:33] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:33] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:33] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:33] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=31
[2025-12-09 08:01:33] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:33] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:33] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:33] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:33] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:34] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:34] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:34] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:34] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:34] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:34] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=32
[2025-12-09 08:01:34] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:34] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:34] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:34] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:34] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:36] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:36] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:36] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:36] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:36] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:36] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=33
[2025-12-09 08:01:36] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:36] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:36] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:36] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:36] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:37] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:37] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:37] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:37] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:37] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:37] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=34
[2025-12-09 08:01:37] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:37] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:37] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:37] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:37] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:38] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:38] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:39] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:39] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:39] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:39] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=35
[2025-12-09 08:01:39] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:39] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:39] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:39] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:39] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:40] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:40] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:40] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:40] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:40] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:40] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=36
[2025-12-09 08:01:40] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:40] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:40] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:40] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:40] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:41] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90474.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90474.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90474.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90474.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:41] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:41] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:42] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90474.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90474.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90474.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90474.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:42] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:42] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=37
[2025-12-09 08:01:42] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:42] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:42] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:42] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:42] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:43] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90474.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90474.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90474.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90474.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:43] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:43] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:43] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90474.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90474.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90474.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90474.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:43] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:43] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=38
[2025-12-09 08:01:43] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:43] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:43] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:43] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:43] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:44] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90477.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90477.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90477.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90477.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:44] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:44] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:44] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90477.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90477.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90477.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90477.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:44] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:44] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=39
[2025-12-09 08:01:44] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:44] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:44] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:44] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:44] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:46] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90480.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90480.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90480.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90480.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:46] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:46] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:46] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90480.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90480.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90480.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90480.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:46] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:46] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=40
[2025-12-09 08:01:46] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:46] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:46] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:46] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:46] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:47] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90480.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90480.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90480.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90480.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:47] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:47] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:47] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90480.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90480.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90480.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90480.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:47] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:47] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=41
[2025-12-09 08:01:47] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:47] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:47] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:47] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:47] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:49] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90480.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90480.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90480.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90480.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:49] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:49] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:49] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90480.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90480.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90480.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90480.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:49] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:49] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=42
[2025-12-09 08:01:49] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:49] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:49] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:49] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:49] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:50] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90480.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90480.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90480.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90480.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:50] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:50] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:50] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90480.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90480.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90480.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90480.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:50] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:50] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=43
[2025-12-09 08:01:50] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:50] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:50] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:50] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:50] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:52] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:52] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:52] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:52] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:52] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:52] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=44
[2025-12-09 08:01:52] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:52] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:52] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:52] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:52] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:53] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90491.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90491.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90491.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90491.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:53] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:53] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:53] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90491.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90491.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90491.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90491.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:53] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:53] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=45
[2025-12-09 08:01:53] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:53] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:53] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:53] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:53] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:55] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90491.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90491.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90491.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90491.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:55] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:55] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:55] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90491.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90491.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90491.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90491.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:55] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:55] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=46
[2025-12-09 08:01:55] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:55] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:55] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:55] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:55] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:56] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:56] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:56] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:56] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:56] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:56] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=47
[2025-12-09 08:01:56] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:56] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:56] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:56] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:56] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:57] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.98', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.98, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.98', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.98, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:57] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:57] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:58] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.98', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.98, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.98', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.98, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:58] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:58] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=48
[2025-12-09 08:01:58] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:58] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:58] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:58] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:58] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:01:59] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.98', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.98, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.98', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.98, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:59] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:59] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:59] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.98', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.98, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.98', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.98, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:01:59] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:01:59] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=49
[2025-12-09 08:01:59] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:01:59] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:01:59] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:01:59] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:01:59] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:00] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:00] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:00] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:00] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:00] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:00] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=50
[2025-12-09 08:02:00] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:00] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:00] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:00] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:00] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:02] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90489', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90489.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90489', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90489.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:02] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:02] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:02] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90489', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90489.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90489', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90489.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:02] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:02] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=51
[2025-12-09 08:02:02] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:02] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:02] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:02] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:02] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:03] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488.12', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.12, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488.12', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.12, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:03] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:03] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:03] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488.06', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.06, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488.06', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.06, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:03] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:03] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=52
[2025-12-09 08:02:03] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:03] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:03] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:03] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:03] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:05] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488.02', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.02, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488.02', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.02, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:05] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:05] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:05] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488.02', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.02, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488.02', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.02, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:05] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:05] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=53
[2025-12-09 08:02:05] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:05] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:05] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:05] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:05] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:06] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.42', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.42, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.42', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.42, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:06] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:06] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:06] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.42', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.42, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.42', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.42, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:06] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:06] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=54
[2025-12-09 08:02:06] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:06] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:06] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:06] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:06] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:08] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.38', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.38, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.38', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.38, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:08] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:08] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:08] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.38', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.38, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.38', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.38, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:08] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:08] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=55
[2025-12-09 08:02:08] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:08] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:08] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:08] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:08] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:09] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.35', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.35, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.35', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.35, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:09] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:09] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:09] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.35', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.35, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.35', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.35, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:09] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:09] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=56
[2025-12-09 08:02:09] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:09] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:09] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:09] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:09] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:10] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.34', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.34, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.34', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.34, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:10] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:11] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:11] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.34', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.34, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.34', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.34, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:11] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:11] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=57
[2025-12-09 08:02:11] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:11] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:11] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:11] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:11] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:12] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:12] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:12] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:12] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:12] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:12] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=58
[2025-12-09 08:02:12] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:12] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:12] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:12] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:12] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:13] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.26', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.26, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.26', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.26, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:13] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:13] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:14] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.26', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.26, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.26', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.26, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:14] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:14] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=59
[2025-12-09 08:02:14] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:14] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:14] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:14] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:14] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:15] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.31', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.31, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.31', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.31, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:15] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:15] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:15] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.31', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.31, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.31', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.31, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:15] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:15] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=60
[2025-12-09 08:02:15] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:15] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:15] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:15] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:15] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:16] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:16] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:16] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:16] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:16] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:16] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=61
[2025-12-09 08:02:16] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:16] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:16] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:16] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:16] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:18] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.33', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.33, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.33', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.33, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:18] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:18] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:18] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.33', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.33, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.33', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.33, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:18] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:18] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=62
[2025-12-09 08:02:18] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:18] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:18] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:18] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:18] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:19] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.34', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.34, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.34', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.34, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:19] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:19] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:19] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.34', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.34, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.34', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.34, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:19] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:19] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=63
[2025-12-09 08:02:19] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:19] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:19] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:19] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:19] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:21] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.34', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.34, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.34', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.34, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:21] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:21] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:21] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.34', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.34, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.34', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.34, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:21] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:21] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=64
[2025-12-09 08:02:21] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:21] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:21] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:21] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:21] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:22] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.36', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.36, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.36', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.36, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:22] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:22] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:22] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.36', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.36, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.36', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.36, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:22] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:22] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=65
[2025-12-09 08:02:22] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:22] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:22] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:22] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:22] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:24] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.38', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.38, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.38', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.38, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:24] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:24] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:24] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.38', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.38, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.38', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.38, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:24] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:24] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=66
[2025-12-09 08:02:24] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:24] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:24] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:24] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:24] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:25] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.39', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.39, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.39', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.39, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:25] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:25] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:25] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.39', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.39, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.39', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.39, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:25] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:25] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=67
[2025-12-09 08:02:25] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:25] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:25] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:25] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:25] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:26] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.95', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.95, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.95', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.95, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:26] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:26] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:27] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.95', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.95, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.95', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.95, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:27] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:27] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=68
[2025-12-09 08:02:27] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:27] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:27] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:27] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:27] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:28] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.97', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.97, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.97', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.97, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:28] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:28] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:28] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.97', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.97, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.97', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.97, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:28] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:28] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=69
[2025-12-09 08:02:28] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:28] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:28] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:28] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:28] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:29] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.85', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.85, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.85', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.85, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:29] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:29] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:29] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.85', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.85, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.85', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.85, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:29] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:29] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=70
[2025-12-09 08:02:30] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:30] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:30] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:30] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:30] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:31] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.78', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.78, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.78', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.78, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:31] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:31] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:31] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.78', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.78, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.78', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.78, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:31] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:31] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=71
[2025-12-09 08:02:31] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:31] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:31] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:31] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:31] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:32] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.71', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.71, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.71', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.71, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:32] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:32] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:32] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.62', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.62, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.62', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.62, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:32] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:32] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=72
[2025-12-09 08:02:32] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:32] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:32] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:32] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:32] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:34] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.52', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.52, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.52', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.52, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:34] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:34] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:34] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.52', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.52, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.52', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.52, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:34] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:34] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=73
[2025-12-09 08:02:34] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:34] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:34] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:34] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:34] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:35] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.58', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.58, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.58', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.58, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:35] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:35] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:35] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.58', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.58, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.58', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.58, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:35] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:35] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=74
[2025-12-09 08:02:35] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:35] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:35] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:35] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:35] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:37] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:37] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:37] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:37] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:37] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:37] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=75
[2025-12-09 08:02:37] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:37] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:37] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:37] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:37] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:38] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.59', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.59, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.59', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.59, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:38] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:38] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:38] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90486.35', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90486.35, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90486.35', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90486.35, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:38] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:38] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=76
[2025-12-09 08:02:38] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:38] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:38] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:38] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:38] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:40] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90486.34', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90486.34, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90486.34', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90486.34, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:40] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:40] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:40] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90486.34', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90486.34, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90486.34', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90486.34, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:40] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:40] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=77
[2025-12-09 08:02:40] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:40] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:40] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:40] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:40] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:41] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90486.34', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90486.34, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90486.34', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90486.34, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:41] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:41] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:41] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90486.34', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90486.34, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90486.34', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90486.34, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:41] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:41] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=78
[2025-12-09 08:02:41] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:41] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:41] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:41] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:41] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:42] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90493.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90493.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90493.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90493.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:42] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:42] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:43] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90493.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90493.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90493.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90493.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:43] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:43] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=79
[2025-12-09 08:02:43] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:43] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:43] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:43] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:43] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:44] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90493.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90493.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90493.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90493.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:44] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:44] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:44] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90493.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90493.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90493.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90493.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:44] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:44] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=80
[2025-12-09 08:02:44] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:44] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:44] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:44] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:44] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:45] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90493.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90493.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90493.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90493.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:45] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:45] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:45] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90493.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90493.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90493.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90493.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:45] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:45] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=81
[2025-12-09 08:02:45] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:45] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:45] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:45] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:45] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:47] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90486.81', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90486.81, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90486.81', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90486.81, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:47] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:47] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:47] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90486.81', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90486.81, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90486.81', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90486.81, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:47] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:47] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=82
[2025-12-09 08:02:47] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:47] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:47] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:47] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:47] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:48] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488.05', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.05, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488.05', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.05, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:48] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:48] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:48] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488.05', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.05, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488.05', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.05, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:48] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:48] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=83
[2025-12-09 08:02:48] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:48] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:48] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:48] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:48] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:50] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488.09', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.09, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488.09', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.09, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:50] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:50] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:50] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488.09', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.09, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488.09', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.09, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:50] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:50] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=84
[2025-12-09 08:02:50] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:50] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:50] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:50] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:50] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:51] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488.15', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.15, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488.15', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.15, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:51] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:51] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:51] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488.15', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.15, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488.15', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.15, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:51] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:51] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=85
[2025-12-09 08:02:51] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:51] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:51] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:51] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:51] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:53] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488.18', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.18, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488.18', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.18, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:53] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:53] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:53] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488.18', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.18, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488.18', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.18, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:53] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:53] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=86
[2025-12-09 08:02:53] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:53] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:53] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:53] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:53] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:54] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488.07', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.07, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488.07', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.07, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:54] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:54] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:54] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488.07', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.07, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90488.07', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90488.07, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:54] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:54] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=87
[2025-12-09 08:02:54] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:54] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:54] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:54] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:54] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:56] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.87', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.87, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.87', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.87, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:56] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:56] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:56] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.87', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.87, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.87', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.87, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:56] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:56] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=88
[2025-12-09 08:02:56] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:56] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:56] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:56] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:56] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:57] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.83', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.83, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.83', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.83, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:57] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:57] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:57] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.83', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.83, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.83', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.83, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:57] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:57] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=89
[2025-12-09 08:02:57] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:57] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:57] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:57] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:57] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:02:58] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.74', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.74, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.74', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.74, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:58] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:58] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:59] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.74', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.74, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.74', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.74, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:02:59] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:02:59] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=90
[2025-12-09 08:02:59] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:02:59] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:02:59] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:02:59] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:02:59] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:00] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.64', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.64, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.64', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.64, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:00] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:00] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:00] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.64', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.64, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.64', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.64, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:00] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:00] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=91
[2025-12-09 08:03:00] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:00] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:00] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:00] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:00] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:01] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.57', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.57, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.57', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.57, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:01] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:01] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:01] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.46', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.46, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.46', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.46, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:01] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:01] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=92
[2025-12-09 08:03:01] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:01] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:01] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:01] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:01] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:03] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.44', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.44, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.44', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.44, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:03] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:03] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:03] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.44', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.44, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90487.44', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90487.44, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:03] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:03] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=93
[2025-12-09 08:03:03] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:03] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:03] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:03] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:03] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:04] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:04] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:04] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:04] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:04] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:04] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=94
[2025-12-09 08:03:04] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:04] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:04] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:04] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:04] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:06] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:06] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:06] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:06] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:06] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:06] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=95
[2025-12-09 08:03:06] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:06] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:06] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:06] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:06] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:07] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:07] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:07] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:07] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:07] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:07] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=96
[2025-12-09 08:03:07] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:07] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:07] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:07] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:07] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:09] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:09] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:09] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:09] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:09] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:09] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=97
[2025-12-09 08:03:09] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:09] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:09] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:09] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:09] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:10] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:10] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:10] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:10] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:10] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:10] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=98
[2025-12-09 08:03:10] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:10] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:10] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:10] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:10] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:12] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90494.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90494.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90494.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90494.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:12] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:12] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:12] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90494.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90494.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90494.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90494.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:12] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:12] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=99
[2025-12-09 08:03:12] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:12] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:12] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:12] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:12] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:13] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90494.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90494.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90494.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90494.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:13] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:13] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:13] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90494.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90494.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90494.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90494.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:13] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:13] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=100
[2025-12-09 08:03:13] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:13] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:13] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:13] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:13] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:14] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90494.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90494.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90494.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90494.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:14] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:14] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:15] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90494.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90494.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90494.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90494.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:15] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:15] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=101
[2025-12-09 08:03:15] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:15] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:15] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:15] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:15] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:16] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90494.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90494.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90494.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90494.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:16] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:16] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:16] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90494.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90494.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90494.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90494.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:16] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:16] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=102
[2025-12-09 08:03:16] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:16] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:16] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:16] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:16] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:17] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:17] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:17] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:17] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:17] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:17] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=103
[2025-12-09 08:03:17] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:17] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:17] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:17] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:17] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:19] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:19] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:19] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:19] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:19] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:19] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=104
[2025-12-09 08:03:19] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:19] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:19] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:19] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:19] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:20] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90513.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90513.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90513.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90513.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:20] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:20] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:20] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90513.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90513.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90513.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90513.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:20] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:20] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=105
[2025-12-09 08:03:20] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:20] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:20] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:20] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:20] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:22] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90513.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90513.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90513.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90513.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:22] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:22] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:22] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90513.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90513.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90513.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90513.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:22] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:22] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=106
[2025-12-09 08:03:22] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:22] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:22] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:22] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:22] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:23] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90513.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90513.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90513.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90513.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:23] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:23] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:23] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90513.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90513.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90513.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90513.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:23] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:23] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=107
[2025-12-09 08:03:23] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:23] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:23] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:23] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:23] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:25] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90513.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90513.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90513.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90513.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:25] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:25] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:25] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90513.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90513.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90513.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90513.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:25] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:25] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=108
[2025-12-09 08:03:25] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:25] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:25] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:25] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:25] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:26] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90513.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90513.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90513.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90513.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:26] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:26] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:26] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90513.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90513.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90513.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90513.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:26] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:26] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=109
[2025-12-09 08:03:26] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:26] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:26] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:26] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:26] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:28] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90505.15', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90505.15, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90505.15', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90505.15, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:28] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:28] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:28] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90505.15', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90505.15, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90505.15', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90505.15, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:28] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:28] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=110
[2025-12-09 08:03:28] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:28] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:28] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:28] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:28] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:29] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.72', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.72, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.72', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.72, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:29] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:29] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:29] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.72', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.72, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.72', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.72, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:29] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:29] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=111
[2025-12-09 08:03:29] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:29] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:29] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:29] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:29] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:30] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90499.76', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90499.76, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90499.76', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90499.76, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:30] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:30] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:31] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90499.76', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90499.76, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90499.76', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90499.76, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:31] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:31] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=112
[2025-12-09 08:03:31] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:31] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:31] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:31] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:31] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:32] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:32] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:32] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:32] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:32] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:32] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=113
[2025-12-09 08:03:32] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:32] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:32] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:32] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:32] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:33] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:33] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:33] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:33] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:33] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:33] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=114
[2025-12-09 08:03:33] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:33] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:33] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:33] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:33] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:35] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:35] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:35] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:35] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:35] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:35] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=115
[2025-12-09 08:03:35] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:35] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:35] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:35] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:35] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:36] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:36] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:36] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:36] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:36] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:36] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=116
[2025-12-09 08:03:36] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:36] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:36] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:36] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:36] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:38] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.57', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.57, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.57', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.57, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:38] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:38] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:38] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.57', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.57, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.57', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.57, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:38] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:38] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=117
[2025-12-09 08:03:38] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:38] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:38] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:38] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:38] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:39] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.52', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.52, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.52', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.52, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:39] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:39] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:39] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.52', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.52, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.52', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.52, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:39] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:39] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=118
[2025-12-09 08:03:39] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:39] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:39] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:39] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:39] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:41] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.05', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.05, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.05', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.05, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:41] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:41] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:41] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.05', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.05, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.05', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.05, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:41] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:41] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=119
[2025-12-09 08:03:41] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:41] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:41] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:41] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:41] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:42] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90507.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90507.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90507.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90507.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:42] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:42] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:42] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90507.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90507.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90507.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90507.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:42] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:42] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=120
[2025-12-09 08:03:42] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:42] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:42] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:42] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:42] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:44] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90507.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90507.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90507.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90507.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:44] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:44] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:44] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90507.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90507.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90507.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90507.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:44] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:44] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=121
[2025-12-09 08:03:44] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:44] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:44] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:44] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:44] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:45] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:45] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:45] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:45] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:45] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:45] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=122
[2025-12-09 08:03:45] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:45] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:45] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:45] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:45] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:46] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:46] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:47] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:47] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:47] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:47] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=123
[2025-12-09 08:03:47] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:47] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:47] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:47] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:47] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:48] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:48] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:48] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:48] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:48] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:48] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=124
[2025-12-09 08:03:48] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:48] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:48] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:48] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:48] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:49] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:49] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:49] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:50] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:50] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:50] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=125
[2025-12-09 08:03:50] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:50] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:50] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:50] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:50] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:51] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:51] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:51] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:51] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:51] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:51] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=126
[2025-12-09 08:03:51] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:51] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:51] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:51] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:51] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:52] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:52] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:52] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:52] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:52] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:52] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=127
[2025-12-09 08:03:52] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:52] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:52] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:52] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:52] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:54] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:54] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:54] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:54] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:54] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:54] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=128
[2025-12-09 08:03:54] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:54] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:54] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:54] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:54] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:55] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:55] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:55] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:55] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:55] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:55] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=129
[2025-12-09 08:03:55] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:55] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:55] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:55] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:55] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:57] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:57] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:57] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:57] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:57] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:57] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=130
[2025-12-09 08:03:57] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:57] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:57] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:57] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:57] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:03:58] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:58] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:58] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:58] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90502', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90502.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:03:58] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:03:58] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=131
[2025-12-09 08:03:58] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:03:58] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:03:58] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:03:58] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:03:58] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:00] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.15', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.15, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.15', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.15, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:00] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:00] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:00] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.15', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.15, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.15', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.15, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:00] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:00] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=132
[2025-12-09 08:04:00] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:00] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:00] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:00] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:00] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:01] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.02', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.02, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.02', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.02, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:01] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:01] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:01] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.02', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.02, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.02', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.02, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:01] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:01] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=133
[2025-12-09 08:04:01] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:01] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:01] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:01] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:01] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:02] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.27', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.27, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.27', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.27, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:02] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:02] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:03] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.27', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.27, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.27', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.27, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:03] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:03] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=134
[2025-12-09 08:04:03] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:03] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:03] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:03] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:03] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:04] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.24', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.24, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.24', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.24, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:04] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:04] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:04] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.24', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.24, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.24', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.24, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:04] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:04] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=135
[2025-12-09 08:04:04] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:04] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:04] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:04] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:04] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:05] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.17', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.17, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.17', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.17, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:05] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:05] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:05] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.17', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.17, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.17', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.17, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:05] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:05] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=136
[2025-12-09 08:04:06] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:06] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:06] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:06] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:06] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:07] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.14', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.14, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.14', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.14, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:07] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:07] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:07] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.14', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.14, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.14', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.14, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:07] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:07] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=137
[2025-12-09 08:04:07] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:07] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:07] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:07] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:07] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:08] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:08] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:08] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:08] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.05', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.05, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.05', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.05, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:08] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:08] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=138
[2025-12-09 08:04:08] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:08] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:08] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:08] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:08] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:10] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.04', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.04, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.04', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.04, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:10] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:10] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:10] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.04', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.04, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90501.04', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90501.04, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:10] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:10] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=139
[2025-12-09 08:04:10] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:10] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:10] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:10] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:10] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:11] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.89', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.89, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.89', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.89, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:11] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:11] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:11] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.89', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.89, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.89', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.89, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:11] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:11] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=140
[2025-12-09 08:04:11] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:11] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:11] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:11] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:11] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:13] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90496.57', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90496.57, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90496.57', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90496.57, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:13] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:13] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:13] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90496.57', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90496.57, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90496.57', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90496.57, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:13] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:13] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=141
[2025-12-09 08:04:13] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:13] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:13] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:13] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:13] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:14] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90494.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90494.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90494.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90494.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:14] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:14] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:14] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90494.41', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90494.41, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90494.41', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90494.41, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:14] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:14] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=142
[2025-12-09 08:04:14] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:14] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:14] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:14] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:14] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:16] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.34', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.34, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.34', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.34, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:16] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:16] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:16] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.34', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.34, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.34', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.34, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:16] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:16] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=143
[2025-12-09 08:04:16] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:16] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:16] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:16] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:16] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:17] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.18', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.18, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.18', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.18, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:17] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:17] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:17] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.18', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.18, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.18', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.18, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:17] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:17] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=144
[2025-12-09 08:04:17] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:17] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:17] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:17] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:17] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:19] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90483.29', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90483.29, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90483.29', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90483.29, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:19] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:19] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:19] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90483.29', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90483.29, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90483.29', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90483.29, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:19] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:19] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=145
[2025-12-09 08:04:19] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:19] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:19] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:19] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:19] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:20] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90483.15', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90483.15, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90483.15', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90483.15, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:20] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:20] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:20] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90483.15', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90483.15, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90483.15', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90483.15, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:20] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:20] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=146
[2025-12-09 08:04:20] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:20] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:20] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:20] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:20] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:21] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.82', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.82, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.82', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.82, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:21] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:21] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:22] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.82', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.82, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.82', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.82, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:22] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:22] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=147
[2025-12-09 08:04:22] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:22] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:22] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:22] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:22] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:23] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.62', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.62, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.62', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.62, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:23] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:23] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:23] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.62', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.62, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.62', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.62, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:23] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:23] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=148
[2025-12-09 08:04:23] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:23] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:23] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:23] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:23] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:24] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.36', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.36, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.36', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.36, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:24] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:24] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:24] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.36', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.36, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.36', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.36, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:24] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:24] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=149
[2025-12-09 08:04:24] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:24] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:24] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:25] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:25] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:26] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.31', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.31, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.31', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.31, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:26] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:26] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:26] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.31', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.31, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.31', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.31, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:26] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:26] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=150
[2025-12-09 08:04:26] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:26] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:26] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:26] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:26] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:27] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:27] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:27] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:27] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.22', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.22, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.22', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.22, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:27] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:27] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=151
[2025-12-09 08:04:27] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:27] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:27] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:27] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:27] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:29] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90481.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90481.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90481.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90481.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:29] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:29] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:29] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90481.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90481.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90481.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90481.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:29] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:29] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=152
[2025-12-09 08:04:29] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:29] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:29] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:29] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:29] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:30] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90480.13', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90480.13, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90480.13', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90480.13, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:30] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:30] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:30] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90480.13', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90480.13, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90480.13', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90480.13, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:30] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:30] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=153
[2025-12-09 08:04:30] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:30] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:30] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:30] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:30] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:32] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90460.45', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90460.45, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90460.45', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90460.45, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:32] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:32] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:32] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90460.45', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90460.45, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90460.45', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90460.45, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:32] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:32] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=154
[2025-12-09 08:04:32] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:32] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:32] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:32] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:32] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:33] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90460.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90460.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90460.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90460.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:33] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:33] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:33] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90460.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90460.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90460.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90460.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:33] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:33] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=155
[2025-12-09 08:04:33] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:33] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:33] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:33] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:33] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:35] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90460.41', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90460.41, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90460.41', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90460.41, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:35] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:35] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:35] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90460.41', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90460.41, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90460.41', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90460.41, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:35] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:35] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=156
[2025-12-09 08:04:35] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:35] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:35] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:35] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:35] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:36] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90460.52', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90460.52, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90460.52', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90460.52, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:36] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:36] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:36] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90460.52', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90460.52, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90460.52', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90460.52, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:36] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:36] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=157
[2025-12-09 08:04:36] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:36] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:36] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:36] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:36] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:37] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90456.84', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90456.84, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90456.84', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90456.84, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:37] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:37] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:38] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90456.84', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90456.84, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90456.84', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90456.84, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:38] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:38] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=158
[2025-12-09 08:04:38] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:38] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:38] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:38] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:38] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:39] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90456.79', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90456.79, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90456.79', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90456.79, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:39] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:39] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:39] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90456.79', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90456.79, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90456.79', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90456.79, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:39] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:39] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=159
[2025-12-09 08:04:39] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:39] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:39] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:39] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:39] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:40] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.26', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.26, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.26', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.26, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:40] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:40] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:40] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.26', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.26, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.26', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.26, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:40] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:40] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=160
[2025-12-09 08:04:40] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:40] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:40] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:40] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:40] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:42] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90435.35', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90435.35, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90435.35', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90435.35, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:42] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:42] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:42] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90435.35', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90435.35, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90435.35', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90435.35, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:42] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:42] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=161
[2025-12-09 08:04:42] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:42] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:42] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:42] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:42] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:43] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90436.87', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90436.87, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90436.87', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90436.87, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:43] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:43] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:43] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90436.87', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90436.87, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90436.87', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90436.87, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:43] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:43] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=162
[2025-12-09 08:04:43] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:43] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:43] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:43] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:43] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:45] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90436.85', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90436.85, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90436.85', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90436.85, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:45] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:45] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:45] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90436.85', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90436.85, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90436.85', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90436.85, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:45] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:45] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=163
[2025-12-09 08:04:45] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:45] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:45] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:45] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:45] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:46] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90436.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90436.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90436.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90436.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:46] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:46] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:46] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90436.75', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90436.75, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90436.75', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90436.75, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:46] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:46] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=164
[2025-12-09 08:04:46] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:46] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:46] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:46] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:46] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:48] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90436.16', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90436.16, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90436.16', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90436.16, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:48] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:48] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:48] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90436.16', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90436.16, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90436.16', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90436.16, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:48] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:48] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=165
[2025-12-09 08:04:48] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:48] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:48] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:48] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:48] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:49] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90436.11', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90436.11, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90436.11', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90436.11, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:49] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:49] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:49] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90436.11', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90436.11, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90436.11', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90436.11, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:49] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:49] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=166
[2025-12-09 08:04:49] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:49] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:49] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:49] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:49] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:51] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90435.98', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90435.98, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90435.98', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90435.98, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:51] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:51] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:51] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90435.98', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90435.98, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90435.98', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90435.98, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:51] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:51] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=167
[2025-12-09 08:04:51] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:51] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:51] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:51] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:51] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:52] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90436.35', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90436.35, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90436.35', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90436.35, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:52] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:52] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:52] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90436.35', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90436.35, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90436.35', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90436.35, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:52] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:52] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=168
[2025-12-09 08:04:52] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:52] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:52] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:52] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:52] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:53] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90436.96', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90436.96, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90436.96', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90436.96, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:53] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:53] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:54] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90436.96', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90436.96, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90436.96', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90436.96, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:54] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:54] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=169
[2025-12-09 08:04:54] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:54] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:54] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:54] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:54] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:55] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90436.86', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90436.86, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90436.86', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90436.86, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:55] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:55] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:55] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90436.86', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90436.86, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90436.86', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90436.86, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:55] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:55] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=170
[2025-12-09 08:04:55] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:55] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:55] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:55] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:55] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:56] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90450.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90450.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90450.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90450.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:56] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:56] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:56] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90453.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90453.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90453.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90453.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:56] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:56] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=171
[2025-12-09 08:04:56] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:56] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:56] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:56] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:56] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:58] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90446.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90446.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90446.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90446.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:58] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:58] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:58] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90446.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90446.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90446.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90446.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:58] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:58] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=172
[2025-12-09 08:04:58] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:58] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:58] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:58] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:58] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:04:59] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90444.68', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90444.68, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90444.68', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90444.68, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:59] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:59] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:59] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90444.68', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90444.68, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90444.68', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90444.68, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:04:59] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:04:59] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=173
[2025-12-09 08:04:59] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:04:59] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:04:59] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:04:59] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:04:59] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:01] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90460.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90460.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90460.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90460.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:01] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:01] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:01] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90460.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90460.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90460.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90460.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:01] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:01] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=174
[2025-12-09 08:05:01] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:01] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:01] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:01] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:01] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:02] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90452.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90452.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90452.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90452.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:02] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:02] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:02] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90450.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90450.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90450.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90450.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:02] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:02] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=175
[2025-12-09 08:05:02] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:02] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:02] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:02] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:02] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:04] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90450.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90450.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90450.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90450.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:04] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:04] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:04] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90450.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90450.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90450.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90450.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:04] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:04] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=176
[2025-12-09 08:05:04] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:04] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:04] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:04] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:04] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:05] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90450.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90450.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90450.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90450.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:05] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:05] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:05] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90450.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90450.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90450.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90450.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:05] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:05] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=177
[2025-12-09 08:05:05] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:05] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:05] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:05] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:05] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:07] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90450.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90450.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90450.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90450.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:07] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:07] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:07] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90450.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90450.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90450.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90450.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:07] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:07] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=178
[2025-12-09 08:05:07] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:07] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:07] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:07] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:07] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:08] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90450.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90450.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90450.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90450.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:08] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:08] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:08] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90450.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90450.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90450.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90450.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:08] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:08] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=179
[2025-12-09 08:05:08] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:08] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:08] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:08] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:08] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:09] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90455', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90455.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90455', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90455.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:09] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:09] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:10] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90455', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90455.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90455', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90455.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:10] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:10] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=180
[2025-12-09 08:05:10] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:10] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:10] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:10] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:10] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:11] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90450.32', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90450.32, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90450.32', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90450.32, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:11] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:11] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:11] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90450.32', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90450.32, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90450.32', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90450.32, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:11] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:11] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=181
[2025-12-09 08:05:11] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:11] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:11] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:11] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:11] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:12] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90448.52', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90448.52, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90448.52', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90448.52, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:12] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:12] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:12] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90448.52', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90448.52, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90448.52', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90448.52, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:12] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:12] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=182
[2025-12-09 08:05:12] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:12] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:12] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:12] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:12] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:14] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90439.32', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90439.32, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90439.32', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90439.32, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:14] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:14] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:14] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90439.32', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90439.32, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90439.32', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90439.32, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:14] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:14] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=183
[2025-12-09 08:05:14] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:14] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:14] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:14] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:14] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:15] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.88', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.88, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.88', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.88, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:15] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:15] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:15] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:15] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:15] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=184
[2025-12-09 08:05:15] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:15] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:15] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:15] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:15] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:17] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.54', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.54, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.54', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.54, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:17] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:17] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:17] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.54', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.54, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.54', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.54, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:17] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:17] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=185
[2025-12-09 08:05:17] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:17] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:17] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:17] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:17] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:18] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.19', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.19, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.19', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.19, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:18] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:18] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:18] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.19', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.19, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.19', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.19, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:18] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:18] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=186
[2025-12-09 08:05:18] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:18] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:18] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:18] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:18] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:20] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90435.83', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90435.83, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90435.83', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90435.83, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:20] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:20] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:20] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90435.83', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90435.83, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90435.83', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90435.83, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:20] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:20] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=187
[2025-12-09 08:05:20] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:20] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:20] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:20] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:20] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:21] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90435.58', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90435.58, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90435.58', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90435.58, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:21] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:21] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:21] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90417.33', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90417.33, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90417.33', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90417.33, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:21] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:21] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=188
[2025-12-09 08:05:21] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:21] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:21] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:21] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:21] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:23] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90416.49', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90416.49, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90416.49', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90416.49, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:23] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:23] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:23] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90416.49', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90416.49, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90416.49', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90416.49, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:23] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:23] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=189
[2025-12-09 08:05:23] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:23] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:23] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:23] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:23] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:24] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90416.23', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90416.23, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90416.23', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90416.23, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:24] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:24] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:24] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90416.23', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90416.23, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90416.23', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90416.23, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:24] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:24] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=190
[2025-12-09 08:05:24] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:24] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:24] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:24] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:24] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:25] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90416.05', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90416.05, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90416.05', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90416.05, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:25] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:25] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:26] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90417.36', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90417.36, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90417.36', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90417.36, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:26] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:26] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=191
[2025-12-09 08:05:26] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:26] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:26] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:26] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:26] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:27] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90416.37', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90416.37, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90416.37', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90416.37, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:27] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:27] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:27] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90416.37', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90416.37, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90416.37', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90416.37, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:27] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:27] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=192
[2025-12-09 08:05:27] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:27] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:27] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:27] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:27] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:28] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90426.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90426.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90426.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90426.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:28] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:28] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:28] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90426.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90426.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90426.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90426.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:28] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:28] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=193
[2025-12-09 08:05:28] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:28] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:28] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:28] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:28] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:30] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90426.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90426.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90426.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90426.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:30] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:30] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:30] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90426.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90426.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90426.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90426.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:30] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:30] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=194
[2025-12-09 08:05:30] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:30] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:30] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:30] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:30] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:31] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90427.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90427.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90427.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90427.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:31] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:31] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:31] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90431.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90431.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90431.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90431.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:31] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:31] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=195
[2025-12-09 08:05:31] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:31] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:31] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:31] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:31] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:33] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90445.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90445.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90445.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90445.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:33] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:33] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:33] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90445.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90445.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90445.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90445.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:33] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:33] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=196
[2025-12-09 08:05:33] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:33] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:33] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:33] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:33] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:34] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90443.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90443.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90443.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90443.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:34] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:34] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:34] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90443.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90443.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90443.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90443.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:34] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:34] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=197
[2025-12-09 08:05:34] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:34] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:34] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:34] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:34] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:36] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90447.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90447.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90447.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90447.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:36] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:36] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:36] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90447.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90447.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90447.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90447.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:36] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:36] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=198
[2025-12-09 08:05:36] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:36] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:36] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:36] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:36] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:37] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90447.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90447.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90447.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90447.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:37] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:37] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:37] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90447.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90447.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90447.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90447.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:37] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:37] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=199
[2025-12-09 08:05:37] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:37] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:37] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:37] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:37] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:38] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90447.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90447.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90447.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90447.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:38] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:39] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:39] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90447.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90447.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90447.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90447.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:39] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:39] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=200
[2025-12-09 08:05:39] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:39] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:39] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:39] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:39] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:40] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90447.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90447.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90447.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90447.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:40] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:40] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:40] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90447.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90447.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90447.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90447.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:40] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:40] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=201
[2025-12-09 08:05:40] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:40] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:40] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:40] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:40] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:41] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90452', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90452.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90452', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90452.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:41] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:41] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:42] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90452', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90452.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90452', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90452.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:42] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:42] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=202
[2025-12-09 08:05:42] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:42] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:42] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:42] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:42] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:43] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90451.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90451.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90451.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90451.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:43] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:43] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:43] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90451.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90451.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90451.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90451.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:43] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:43] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=203
[2025-12-09 08:05:43] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:43] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:43] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:43] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:43] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:44] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90452', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90452.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90452', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90452.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:44] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:44] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:44] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90451.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90451.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90451.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90451.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:44] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:44] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=204
[2025-12-09 08:05:44] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:44] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:44] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:44] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:44] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:46] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90448.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90448.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90448.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90448.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:46] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:46] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:46] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90448.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90448.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90448.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90448.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:46] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:46] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=205
[2025-12-09 08:05:46] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:46] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:46] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:46] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:46] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:47] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:47] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:47] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:47] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:47] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:47] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=206
[2025-12-09 08:05:47] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:47] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:47] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:47] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:47] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:49] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:49] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:49] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:49] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:49] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:49] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=207
[2025-12-09 08:05:49] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:49] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:49] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:49] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:49] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:50] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:50] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:50] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:50] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:50] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:50] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=208
[2025-12-09 08:05:50] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:50] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:50] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:50] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:50] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:52] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:52] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:52] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:52] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:52] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:52] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=209
[2025-12-09 08:05:52] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:52] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:52] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:52] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:52] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:53] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:53] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:53] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:53] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:53] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:53] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=210
[2025-12-09 08:05:53] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:53] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:53] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:53] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:53] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:55] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:55] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:55] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:55] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:55] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:55] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=211
[2025-12-09 08:05:55] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:55] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:55] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:55] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:55] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:56] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:56] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:56] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:56] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:56] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:56] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=212
[2025-12-09 08:05:56] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:56] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:56] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:56] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:56] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:57] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:57] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:57] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:58] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:58] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:58] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=213
[2025-12-09 08:05:58] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:58] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:58] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:58] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:58] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:05:59] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:59] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:59] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:59] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:05:59] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:05:59] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=214
[2025-12-09 08:05:59] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:05:59] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:05:59] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:05:59] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:05:59] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:06:00] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90455.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90455.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90455.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90455.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:00] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:00] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:00] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90455.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90455.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90455.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90455.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:00] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:00] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=215
[2025-12-09 08:06:00] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:00] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:06:00] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:06:00] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:06:00] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:06:02] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90458.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90458.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90458.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90458.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:02] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:02] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:02] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90458.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90458.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90458.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90458.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:02] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:02] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=216
[2025-12-09 08:06:02] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:02] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:06:02] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:06:02] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:06:02] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:06:03] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90458.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90458.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90458.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90458.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:03] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:03] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:03] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90458.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90458.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90458.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90458.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:03] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:03] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=217
[2025-12-09 08:06:03] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:03] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:06:03] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:06:03] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:06:03] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:06:05] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90458.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90458.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90458.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90458.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:05] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:05] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:05] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90458.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90458.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90458.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90458.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:05] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:05] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=218
[2025-12-09 08:06:05] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:05] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:06:05] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:06:05] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:06:05] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:06:06] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90458.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90458.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90458.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90458.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:06] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:06] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:06] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90458.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90458.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90458.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90458.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:06] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:06] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=219
[2025-12-09 08:06:06] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:06] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:06:06] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:06:06] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:06:06] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:06:08] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90458.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90458.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90458.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90458.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:08] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:08] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:08] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90458.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90458.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90458.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90458.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:08] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:08] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=220
[2025-12-09 08:06:08] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:08] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:06:08] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:06:08] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:06:08] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:06:09] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90458.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90458.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90458.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90458.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:09] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:09] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:09] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90449.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90449.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90449.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90449.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:09] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:09] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=221
[2025-12-09 08:06:09] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:09] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:06:09] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:06:09] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:06:09] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:06:11] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90449.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90449.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90449.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90449.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:11] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:11] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:11] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90449.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90449.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90449.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90449.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:11] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:11] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=222
[2025-12-09 08:06:11] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:11] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:06:11] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:06:11] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:06:11] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:06:12] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90447.01', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90447.01, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90447.01', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90447.01, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:12] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:12] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:12] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90447.01', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90447.01, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90447.01', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90447.01, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:12] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:12] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=223
[2025-12-09 08:06:12] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:12] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:06:12] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:06:12] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:06:12] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:06:13] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90454.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90454.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90454.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90454.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:13] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:13] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:14] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90454.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90454.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90454.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90454.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:14] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:14] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=224
[2025-12-09 08:06:14] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:14] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:06:14] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:06:14] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:06:14] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:06:15] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90459.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90459.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90459.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90459.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:15] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:15] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:15] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90459.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90459.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90459.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90459.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:15] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:15] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=225
[2025-12-09 08:06:15] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:15] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:06:15] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:06:15] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:06:15] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:06:16] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90470.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90470.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90470.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90470.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:16] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:16] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:16] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90470.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90470.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90470.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90470.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:16] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:16] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=226
[2025-12-09 08:06:16] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:16] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:06:16] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:06:16] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:06:16] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:06:18] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90470.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90470.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90470.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90470.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:18] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:18] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:18] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90470.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90470.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90470.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90470.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:18] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:18] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=227
[2025-12-09 08:06:18] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:18] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:06:18] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:06:18] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:06:18] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:06:19] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90470.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90470.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90470.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90470.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:19] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:19] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:19] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90451.32', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90451.32, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90451.32', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90451.32, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:19] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:19] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=228
[2025-12-09 08:06:19] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:19] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:06:19] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:06:19] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:06:19] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:06:21] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90452.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90452.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90452.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90452.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:21] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:21] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:21] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90452.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90452.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90452.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90452.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:21] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:21] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=229
[2025-12-09 08:06:21] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:21] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:06:21] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:06:21] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:06:21] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:06:22] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90458.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90458.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90458.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90458.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:22] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:22] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:22] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90458.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90458.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90458.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90458.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:22] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:22] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=230
[2025-12-09 08:06:22] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:22] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:06:22] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:06:22] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:06:22] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:06:24] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90458.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90458.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90458.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90458.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:24] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:24] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:24] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90458.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90458.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90458.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90458.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:24] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:24] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=231
[2025-12-09 08:06:24] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:24] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:06:24] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:06:24] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:06:24] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:06:25] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90458.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90458.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90458.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90458.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:25] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:25] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:25] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90458.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90458.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90458.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90458.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:25] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:25] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=232
[2025-12-09 08:06:25] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:25] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:06:25] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:06:25] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:06:25] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:06:26] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90451.88', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90451.88, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90451.88', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90451.88, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:26] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:27] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:27] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90451.88', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90451.88, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90451.88', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90451.88, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:27] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:27] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=233
[2025-12-09 08:06:27] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:27] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:06:27] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:06:27] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:06:27] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:06:28] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90451.81', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90451.81, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90451.81', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90451.81, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:28] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:28] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:28] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90451.81', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90451.81, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90451.81', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90451.81, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:28] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:28] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=234
[2025-12-09 08:06:28] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:28] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:06:28] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:06:28] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:06:28] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:06:29] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90451.69', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90451.69, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90451.69', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90451.69, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:29] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:29] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:30] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90451.69', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90451.69, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90451.69', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90451.69, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:30] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:30] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=235
[2025-12-09 08:06:30] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:30] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:06:30] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:06:30] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:06:30] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:06:31] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:31] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:31] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:31] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:31] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:31] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=236
[2025-12-09 08:06:31] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:31] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:06:31] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:06:31] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:06:31] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:06:32] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:32] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:32] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:32] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90450.61', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90450.61, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90450.61', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90450.61, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:32] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:32] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=237
[2025-12-09 08:06:32] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:32] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:06:32] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:06:32] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:06:32] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:06:34] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90450.58', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90450.58, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90450.58', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90450.58, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:34] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:34] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:34] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90450.58', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90450.58, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90450.58', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90450.58, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:34] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:34] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=238
[2025-12-09 08:06:34] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:34] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:06:34] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:06:34] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:06:34] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:06:35] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90450.63', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90450.63, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90450.63', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90450.63, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:35] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:35] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:35] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90450.63', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90450.63, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90450.63', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90450.63, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:35] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:35] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=239
[2025-12-09 08:06:35] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:35] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:06:35] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:06:35] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:06:35] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:06:37] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90445.05', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90445.05, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90445.05', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90445.05, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:37] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:37] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:37] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90445.05', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90445.05, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90445.05', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90445.05, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:37] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:37] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=240
[2025-12-09 08:06:37] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:37] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:06:37] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:06:37] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:06:37] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:06:38] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.46', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.46, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.46', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.46, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:38] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:38] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:38] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.36', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.36, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.36', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.36, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:38] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:38] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=241
[2025-12-09 08:06:38] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:38] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:06:38] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:06:38] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:06:38] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:06:40] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.29', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.29, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.29', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.29, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:40] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:40] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:40] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.29', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.29, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.29', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.29, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:40] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:40] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=242
[2025-12-09 08:06:40] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:40] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:06:40] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:06:40] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:06:40] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:06:41] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:41] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:41] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:41] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90438.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90438.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:06:41] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:06:41] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=243
[2025-12-09 08:06:41] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:06:41] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:06:41] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:06:41] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:06:41] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
