[2025-12-09 08:11:36] [WARNING] exchange_api: [ExchangeAPI] config.SYMBOL=BTC/USDT:USDT Ïù¥ÏßÄÎßå, v10.1 Î™ÖÏÑ∏Ïóê Îî∞Îùº BTCUSDT Î°ú Í≥†Ï†ïÌï©ÎãàÎã§.
[2025-12-09 08:11:37] [WARNING] exchange_api: üß™ [DRY_RUN] Î™®ÎìúÎ°ú ExchangeAPI Ï¥àÍ∏∞Ìôî (Ïã§ Í±∞Îûò ÏóÜÏùå)
[2025-12-09 08:11:37] [WARNING] state_manager: BotState JSON Ïä§ÌÇ§Îßà Ï∞®Ïù¥ Í∞êÏßÄ (missing=set(), extra={'startup_done'}) ‚Üí Ìò∏Ìôò Î™®ÎìúÎ°ú Î°úÎìúÌï©ÎãàÎã§.
[2025-12-09 08:11:37] [INFO] state_manager: BotState Î°úÎìú: mode=NORMAL wave_id=27413 p_center=91702.4 p_gap=206.7389285714285
[2025-12-09 08:11:37] [INFO] escape_config: [escape_config] YAML loaded but no value changes detected.
[2025-12-09 08:11:37] [WARNING] state_manager: BotState JSON Ïä§ÌÇ§Îßà Ï∞®Ïù¥ Í∞êÏßÄ (missing=set(), extra={'startup_done'}) ‚Üí Ìò∏Ìôò Î™®ÎìúÎ°ú Î°úÎìúÌï©ÎãàÎã§.
[2025-12-09 08:11:37] [INFO] state_manager: BotState Î°úÎìú: mode=NORMAL wave_id=27413 p_center=91702.4 p_gap=206.7389285714285
[2025-12-09 08:11:37] [INFO] main_v10: WaveBot v10.1 starting...
[2025-12-09 08:11:37] [INFO] exchange_api: [ExchangeAPI] DRY_RUN - set_leverage_and_mode Ïä§ÌÇµ
[2025-12-09 08:11:37] [INFO] main_v10: WaveBot v10.1 main loop started (interval=1.000s)
[2025-12-09 08:11:38] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90495.62', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90495.62, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90495.62', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90495.62, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:11:38] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:11:38] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:11:38] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90495.62', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90495.62, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90495.62', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90495.62, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:11:38] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:11:38] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=1
[2025-12-09 08:11:38] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:11:38] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:11:40] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90495.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90495.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90495.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90495.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:11:40] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:11:40] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:11:40] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90495.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90495.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90495.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90495.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:11:40] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:11:40] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=2
[2025-12-09 08:11:40] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:11:40] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:11:40] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:11:40] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:11:40] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:11:41] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90495.83', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90495.83, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90495.83', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90495.83, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:11:41] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:11:41] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:11:41] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90495.83', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90495.83, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90495.83', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90495.83, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:11:41] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:11:41] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=3
[2025-12-09 08:11:41] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:11:41] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:11:41] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:11:41] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:11:41] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:11:42] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90495.88', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90495.88, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90495.88', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90495.88, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:11:42] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:11:42] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:11:43] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90495.88', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90495.88, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90495.88', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90495.88, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:11:43] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:11:43] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=4
[2025-12-09 08:11:43] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:11:43] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:11:43] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:11:43] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:11:43] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:11:44] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90495.93', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90495.93, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90495.93', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90495.93, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:11:44] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:11:44] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:11:44] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90495.93', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90495.93, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90495.93', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90495.93, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:11:44] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:11:44] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=5
[2025-12-09 08:11:44] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:11:44] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:11:44] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:11:44] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:11:44] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:11:45] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90495.95', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90495.95, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90495.95', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90495.95, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:11:45] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:11:45] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:11:45] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90495.95', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90495.95, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90495.95', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90495.95, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:11:45] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:11:45] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=6
[2025-12-09 08:11:45] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:11:45] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:11:45] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:11:45] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:11:45] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:11:47] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90495.99', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90495.99, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90495.99', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90495.99, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:11:47] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:11:47] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:11:47] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90495.99', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90495.99, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90495.99', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90495.99, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:11:47] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:11:47] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=7
[2025-12-09 08:11:47] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:11:47] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:11:47] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:11:47] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:11:47] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:11:48] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90496.01', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90496.01, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90496.01', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90496.01, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:11:48] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:11:48] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:11:48] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90496.04', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90496.04, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90496.04', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90496.04, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:11:48] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:11:48] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=8
[2025-12-09 08:11:48] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:11:48] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:11:48] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:11:48] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:11:48] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:11:50] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90496.08', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90496.08, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90496.08', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90496.08, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:11:50] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:11:50] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:11:50] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90496.08', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90496.08, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90496.08', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90496.08, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:11:50] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:11:50] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=9
[2025-12-09 08:11:50] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:11:50] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:11:50] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:11:50] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:11:50] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:11:51] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90499.58', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90499.58, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90499.58', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90499.58, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:11:51] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:11:51] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:11:51] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90499.58', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90499.58, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90499.58', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90499.58, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:11:51] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:11:51] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=10
[2025-12-09 08:11:51] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:11:51] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:11:51] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:11:51] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:11:51] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:11:53] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.04', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.04, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.04', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.04, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:11:53] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:11:53] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:11:53] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.04', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.04, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.04', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.04, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:11:53] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:11:53] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=11
[2025-12-09 08:11:53] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:11:53] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:11:53] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:11:53] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:11:53] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:11:54] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.03', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.03, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.03', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.03, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:11:54] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:11:54] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:11:54] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.03', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.03, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.03', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.03, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:11:54] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:11:54] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=12
[2025-12-09 08:11:54] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:11:54] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:11:54] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:11:54] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:11:54] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:11:56] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.05', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.05, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.05', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.05, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:11:56] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:11:56] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:11:56] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.05', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.05, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.05', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.05, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:11:56] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:11:56] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=13
[2025-12-09 08:11:56] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:11:56] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:11:56] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:11:56] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:11:56] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:11:57] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.05', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.05, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.05', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.05, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:11:57] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:11:57] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:11:57] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.05', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.05, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.05', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.05, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:11:57] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:11:57] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=14
[2025-12-09 08:11:57] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:11:57] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:11:57] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:11:57] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:11:57] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:11:58] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.06', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.06, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.06', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.06, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:11:58] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:11:58] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:11:59] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.06', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.06, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.06', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.06, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:11:59] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:11:59] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=15
[2025-12-09 08:11:59] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:11:59] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:11:59] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:11:59] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:11:59] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:00] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.04', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.04, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.04', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.04, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:00] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:00] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:00] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.04', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.04, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.04', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.04, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:00] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:00] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=16
[2025-12-09 08:12:00] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:00] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:00] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:00] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:00] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:01] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.05', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.05, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.05', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.05, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:01] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:01] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:01] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.05', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.05, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90500.05', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90500.05, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:01] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:01] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=17
[2025-12-09 08:12:01] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:01] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:01] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:01] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:01] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:03] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.58', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.58, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.58', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.58, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:03] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:03] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:03] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.58', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.58, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.58', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.58, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:03] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:03] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=18
[2025-12-09 08:12:03] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:03] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:03] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:03] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:03] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:04] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.07', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.07, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.07', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.07, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:04] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:04] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:04] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.07', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.07, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.07', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.07, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:04] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:04] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=19
[2025-12-09 08:12:04] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:04] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:04] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:04] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:04] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:06] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90481.95', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90481.95, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90481.95', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90481.95, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:06] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:06] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:06] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90481.95', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90481.95, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90481.95', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90481.95, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:06] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:06] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=20
[2025-12-09 08:12:06] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:06] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:06] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:06] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:06] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:07] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90481.64', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90481.64, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90481.64', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90481.64, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:07] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:07] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:07] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90481.59', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90481.59, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90481.59', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90481.59, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:07] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:07] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=21
[2025-12-09 08:12:07] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:07] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:07] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:07] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:07] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:09] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90481.45', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90481.45, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90481.45', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90481.45, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:09] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:09] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:09] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90481.45', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90481.45, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90481.45', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90481.45, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:09] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:09] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=22
[2025-12-09 08:12:09] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:09] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:09] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:09] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:09] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:10] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90481.37', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90481.37, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90481.37', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90481.37, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:10] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:10] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:10] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90481.37', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90481.37, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90481.37', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90481.37, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:10] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:10] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=23
[2025-12-09 08:12:10] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:10] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:10] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:10] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:10] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:12] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90481.09', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90481.09, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90481.09', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90481.09, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:12] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:12] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:12] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90481.09', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90481.09, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90481.09', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90481.09, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:12] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:12] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=24
[2025-12-09 08:12:12] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:12] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:12] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:12] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:12] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:13] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90479.61', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90479.61, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90479.61', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90479.61, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:13] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:13] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:13] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90479.61', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90479.61, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90479.61', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90479.61, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:13] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:13] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=25
[2025-12-09 08:12:13] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:13] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:13] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:13] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:13] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:14] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90479.03', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90479.03, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90479.03', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90479.03, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:14] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:14] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:15] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90479.03', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90479.03, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90479.03', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90479.03, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:15] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:15] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=26
[2025-12-09 08:12:15] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:15] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:15] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:15] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:15] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:16] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.97', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.97, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.97', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.97, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:16] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:16] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:16] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.97', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.97, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.97', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.97, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:16] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:16] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=27
[2025-12-09 08:12:16] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:16] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:16] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:16] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:16] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:17] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.85', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.85, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.85', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.85, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:17] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:17] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:17] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.68', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.68, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.68', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.68, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:17] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:17] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=28
[2025-12-09 08:12:17] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:17] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:17] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:17] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:17] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:19] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.66', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.66, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.66', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.66, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:19] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:19] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:19] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.66', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.66, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.66', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.66, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:19] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:19] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=29
[2025-12-09 08:12:19] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:19] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:19] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:19] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:19] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:20] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.52', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.52, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.52', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.52, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:20] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:20] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:20] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.52', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.52, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.52', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.52, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:20] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:20] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=30
[2025-12-09 08:12:20] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:20] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:20] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:20] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:20] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:22] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90474.94', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90474.94, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90474.94', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90474.94, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:22] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:22] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:22] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90474.94', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90474.94, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90474.94', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90474.94, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:22] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:22] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=31
[2025-12-09 08:12:22] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:22] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:22] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:22] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:22] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:23] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90474.26', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90474.26, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90474.26', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90474.26, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:23] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:23] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:23] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90471.81', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90471.81, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90471.81', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90471.81, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:23] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:23] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=32
[2025-12-09 08:12:23] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:23] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:23] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:23] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:23] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:25] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90467.79', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90467.79, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90467.79', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90467.79, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:25] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:25] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:25] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90467.79', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90467.79, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90467.79', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90467.79, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:25] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:25] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=33
[2025-12-09 08:12:25] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:25] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:25] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:25] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:25] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:26] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90466.79', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90466.79, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90466.79', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90466.79, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:26] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:26] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:26] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90466.79', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90466.79, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90466.79', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90466.79, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:26] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:26] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=34
[2025-12-09 08:12:26] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:26] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:26] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:26] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:26] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:28] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90466.57', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90466.57, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90466.57', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90466.57, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:28] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:28] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:28] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90466.57', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90466.57, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90466.57', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90466.57, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:28] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:28] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=35
[2025-12-09 08:12:28] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:28] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:28] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:28] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:28] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:29] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90466.45', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90466.45, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90466.45', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90466.45, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:29] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:29] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:29] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90466.45', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90466.45, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90466.45', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90466.45, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:29] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:29] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=36
[2025-12-09 08:12:29] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:29] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:29] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:29] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:29] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:30] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90466.25', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90466.25, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90466.25', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90466.25, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:30] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:30] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:31] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90466.25', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90466.25, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90466.25', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90466.25, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:31] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:31] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=37
[2025-12-09 08:12:31] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:31] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:31] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:31] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:31] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:32] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90466.14', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90466.14, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90466.14', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90466.14, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:32] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:32] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:32] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90466.14', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90466.14, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90466.14', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90466.14, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:32] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:32] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=38
[2025-12-09 08:12:32] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:32] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:32] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:32] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:32] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:33] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90465.93', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90465.93, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90465.93', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90465.93, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:33] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:33] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:33] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90465.93', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90465.93, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90465.93', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90465.93, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:33] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:33] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=39
[2025-12-09 08:12:34] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:34] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:34] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:34] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:34] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:35] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90464.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90464.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90464.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90464.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:35] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:35] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:35] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90464.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90464.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90464.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90464.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:35] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:35] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=40
[2025-12-09 08:12:35] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:35] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:35] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:35] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:35] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:36] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90464', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90464.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90464', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90464.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:36] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:36] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:36] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.96', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.96, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.96', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.96, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:36] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:36] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=41
[2025-12-09 08:12:36] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:36] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:36] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:36] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:36] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:38] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.91', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.91, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.91', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.91, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:38] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:38] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:38] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.91', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.91, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.91', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.91, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:38] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:38] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=42
[2025-12-09 08:12:38] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:38] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:38] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:38] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:38] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:39] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.86', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.86, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.86', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.86, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:39] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:39] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:39] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.86', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.86, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.86', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.86, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:39] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:39] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=43
[2025-12-09 08:12:39] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:39] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:39] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:39] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:39] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:41] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.89', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.89, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.89', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.89, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:41] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:41] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:41] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.89', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.89, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.89', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.89, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:41] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:41] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=44
[2025-12-09 08:12:41] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:41] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:41] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:41] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:41] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:42] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.91', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.91, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.91', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.91, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:42] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:42] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:42] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.93', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.93, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.93', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.93, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:42] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:42] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=45
[2025-12-09 08:12:42] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:42] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:42] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:42] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:42] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:44] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.96', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.96, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.96', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.96, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:44] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:44] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:44] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.96', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.96, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.96', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.96, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:44] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:44] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=46
[2025-12-09 08:12:44] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:44] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:44] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:44] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:44] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:45] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.96', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.96, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.96', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.96, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:45] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:45] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:45] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.96', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.96, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.96', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.96, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:45] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:45] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=47
[2025-12-09 08:12:45] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:45] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:45] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:45] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:45] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:46] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.74', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.74, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.74', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.74, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:46] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:46] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:47] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.74', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.74, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.74', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.74, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:47] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:47] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=48
[2025-12-09 08:12:47] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:47] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:47] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:47] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:47] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:48] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90474.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90474.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90474.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90474.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:48] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:48] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:48] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90474.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90474.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90474.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90474.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:48] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:48] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=49
[2025-12-09 08:12:48] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:48] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:48] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:48] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:48] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:49] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:49] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:49] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:49] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:49] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:49] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=50
[2025-12-09 08:12:49] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:49] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:49] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:49] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:49] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:51] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:51] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:51] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:51] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:51] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:51] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=51
[2025-12-09 08:12:51] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:51] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:51] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:51] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:51] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:52] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:52] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:52] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:52] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:52] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:52] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=52
[2025-12-09 08:12:52] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:52] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:52] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:52] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:52] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:54] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:54] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:54] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:54] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:54] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:54] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=53
[2025-12-09 08:12:54] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:54] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:54] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:54] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:54] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:55] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:55] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:55] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:55] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:55] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:55] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=54
[2025-12-09 08:12:55] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:55] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:55] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:55] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:55] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:57] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:57] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:57] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:57] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:57] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:57] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=55
[2025-12-09 08:12:57] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:57] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:57] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:57] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:57] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:12:58] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:58] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:58] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:58] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:12:58] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:12:58] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=56
[2025-12-09 08:12:58] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:12:58] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:12:58] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:12:58] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:12:58] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:00] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:00] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:00] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:00] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:00] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:00] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=57
[2025-12-09 08:13:00] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:00] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:00] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:00] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:00] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:01] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:01] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:01] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:01] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:01] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:01] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=58
[2025-12-09 08:13:01] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:01] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:01] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:01] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:01] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:02] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90471', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90471.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90471', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90471.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:02] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:02] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:03] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90471', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90471.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90471', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90471.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:03] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:03] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=59
[2025-12-09 08:13:03] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:03] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:03] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:03] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:03] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:04] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90470.28', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90470.28, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90470.28', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90470.28, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:04] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:04] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:04] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90470.28', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90470.28, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90470.28', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90470.28, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:04] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:04] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=60
[2025-12-09 08:13:04] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:04] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:04] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:04] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:04] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:05] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90470.32', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90470.32, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90470.32', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90470.32, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:05] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:05] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:05] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90469.22', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90469.22, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90469.22', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90469.22, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:05] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:05] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=61
[2025-12-09 08:13:06] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:06] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:06] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:06] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:06] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:07] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90469.18', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90469.18, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90469.18', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90469.18, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:07] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:07] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:07] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90469.18', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90469.18, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90469.18', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90469.18, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:07] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:07] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=62
[2025-12-09 08:13:07] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:07] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:07] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:07] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:07] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:08] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90469.08', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90469.08, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90469.08', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90469.08, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:08] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:08] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:08] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90469.08', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90469.08, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90469.08', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90469.08, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:08] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:08] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=63
[2025-12-09 08:13:08] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:08] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:08] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:08] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:08] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:10] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90469.03', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90469.03, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90469.03', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90469.03, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:10] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:10] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:10] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90469.03', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90469.03, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90469.03', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90469.03, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:10] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:10] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=64
[2025-12-09 08:13:10] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:10] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:10] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:10] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:10] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:11] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90468.97', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90468.97, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90468.97', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90468.97, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:11] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:11] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:11] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.87', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.87, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.87', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.87, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:11] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:11] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=65
[2025-12-09 08:13:11] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:11] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:11] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:11] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:11] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:13] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.26', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.26, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.26', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.26, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:13] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:13] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:13] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.26', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.26, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.26', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.26, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:13] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:13] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=66
[2025-12-09 08:13:13] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:13] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:13] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:13] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:13] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:14] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.02', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.02, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.02', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.02, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:14] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:14] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:14] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.02', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.02, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.02', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.02, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:14] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:14] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=67
[2025-12-09 08:13:14] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:14] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:14] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:14] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:14] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:16] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:16] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:16] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:16] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:16] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:16] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=68
[2025-12-09 08:13:16] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:16] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:16] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:16] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:16] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:17] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:17] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:17] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:17] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90475.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90475.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:17] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:17] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=69
[2025-12-09 08:13:17] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:17] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:17] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:17] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:17] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:18] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:18] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:18] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:19] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:19] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:19] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=70
[2025-12-09 08:13:19] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:19] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:19] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:19] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:19] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:20] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90483', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90483.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90483', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90483.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:20] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:20] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:20] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90483', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90483.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90483', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90483.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:20] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:20] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=71
[2025-12-09 08:13:20] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:20] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:20] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:20] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:20] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:21] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90490.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90490.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90490.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90490.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:21] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:21] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:21] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90490.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90490.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90490.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90490.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:21] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:21] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=72
[2025-12-09 08:13:22] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:22] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:22] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:22] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:22] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:23] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90490.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90490.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90490.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90490.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:23] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:23] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:23] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90490.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90490.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90490.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90490.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:23] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:23] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=73
[2025-12-09 08:13:23] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:23] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:23] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:23] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:23] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:24] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90490.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90490.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90490.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90490.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:24] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:24] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:24] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90490.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90490.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90490.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90490.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:24] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:24] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=74
[2025-12-09 08:13:24] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:24] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:24] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:24] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:24] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:26] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90486.84', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90486.84, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90486.84', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90486.84, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:26] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:26] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:26] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90486.84', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90486.84, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90486.84', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90486.84, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:26] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:26] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=75
[2025-12-09 08:13:26] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:26] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:26] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:26] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:26] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:27] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90486.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90486.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90486.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90486.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:27] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:27] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:27] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90486.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90486.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90486.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90486.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:27] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:27] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=76
[2025-12-09 08:13:27] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:27] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:27] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:27] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:27] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:29] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90486.12', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90486.12, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90486.12', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90486.12, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:29] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:29] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:29] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90486.12', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90486.12, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90486.12', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90486.12, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:29] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:29] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=77
[2025-12-09 08:13:29] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:29] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:29] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:29] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:29] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:30] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90486.07', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90486.07, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90486.07', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90486.07, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:30] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:30] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:30] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90486.04', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90486.04, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90486.04', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90486.04, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:30] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:30] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=78
[2025-12-09 08:13:30] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:30] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:30] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:30] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:30] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:32] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.99', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.99, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.99', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.99, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:32] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:32] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:32] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.99', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.99, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.99', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.99, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:32] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:32] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=79
[2025-12-09 08:13:32] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:32] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:32] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:32] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:32] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:33] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.94', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.94, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.94', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.94, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:33] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:33] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:33] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.94', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.94, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.94', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.94, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:33] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:33] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=80
[2025-12-09 08:13:33] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:33] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:33] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:33] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:33] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:34] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.53', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.53, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.53', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.53, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:34] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:34] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:35] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.53', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.53, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.53', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.53, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:35] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:35] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=81
[2025-12-09 08:13:35] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:35] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:35] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:35] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:35] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:36] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.51', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.51, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.51', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.51, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:36] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:36] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:36] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.51', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.51, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.51', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.51, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:36] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:36] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=82
[2025-12-09 08:13:36] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:36] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:36] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:36] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:36] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:37] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.46', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.46, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.46', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.46, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:37] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:37] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:37] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.46', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.46, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.46', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.46, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:37] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:37] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=83
[2025-12-09 08:13:37] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:37] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:37] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:37] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:37] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:39] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.45', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.45, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.45', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.45, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:39] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:39] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:39] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.45', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.45, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.45', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.45, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:39] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:39] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=84
[2025-12-09 08:13:39] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:39] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:39] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:39] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:39] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:40] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:40] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:40] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:40] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.37', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.37, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.37', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.37, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:40] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:40] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=85
[2025-12-09 08:13:40] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:40] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:40] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:40] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:40] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:42] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.35', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.35, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.35', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.35, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:42] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:42] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:42] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.35', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.35, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.35', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.35, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:42] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:42] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=86
[2025-12-09 08:13:42] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:42] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:42] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:42] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:42] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:43] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.33', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.33, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.33', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.33, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:43] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:43] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:43] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.33', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.33, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.33', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.33, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:43] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:43] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=87
[2025-12-09 08:13:43] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:43] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:43] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:43] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:43] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:45] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.27', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.27, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.27', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.27, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:45] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:45] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:45] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.27', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.27, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.27', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.27, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:45] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:45] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=88
[2025-12-09 08:13:45] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:45] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:45] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:45] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:45] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:46] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.23', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.23, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.23', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.23, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:46] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:46] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:46] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.23', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.23, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.23', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.23, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:46] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:46] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=89
[2025-12-09 08:13:46] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:46] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:46] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:46] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:46] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:48] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.15', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.15, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.15', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.15, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:48] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:48] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:48] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.15', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.15, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.15', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.15, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:48] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:48] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=90
[2025-12-09 08:13:48] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:48] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:48] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:48] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:48] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:49] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.13', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.13, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.13', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.13, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:49] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:49] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:49] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.13', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.13, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.13', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.13, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:49] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:49] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=91
[2025-12-09 08:13:49] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:49] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:49] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:49] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:49] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:50] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.08', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.08, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.08', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.08, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:50] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:50] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:51] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.08', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.08, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.08', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.08, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:51] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:51] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=92
[2025-12-09 08:13:51] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:51] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:51] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:51] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:51] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:52] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.08', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.08, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.08', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.08, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:52] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:52] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:52] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.08', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.08, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90485.08', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90485.08, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:52] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:52] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=93
[2025-12-09 08:13:52] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:52] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:52] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:52] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:52] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:53] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.89', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.89, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.89', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.89, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:53] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:53] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:53] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.83', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.83, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.83', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.83, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:53] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:53] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=94
[2025-12-09 08:13:53] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:53] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:53] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:53] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:53] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:55] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.84', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.84, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.84', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.84, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:55] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:55] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:55] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.84', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.84, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.84', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.84, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:55] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:55] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=95
[2025-12-09 08:13:55] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:55] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:55] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:55] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:55] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:56] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.63', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.63, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.63', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.63, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:56] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:56] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:56] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.63', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.63, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.63', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.63, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:56] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:56] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=96
[2025-12-09 08:13:56] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:56] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:56] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:56] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:56] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:58] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.54', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.54, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.54', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.54, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:58] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:58] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:58] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.54', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.54, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.54', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.54, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:58] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:58] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=97
[2025-12-09 08:13:58] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:58] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:58] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:58] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:58] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:13:59] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.53', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.53, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.53', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.53, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:59] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:59] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:59] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.41', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.41, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.41', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.41, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:13:59] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:13:59] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=98
[2025-12-09 08:13:59] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:13:59] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:13:59] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:13:59] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:13:59] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:01] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.35', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.35, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.35', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.35, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:01] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:01] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:01] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.35', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.35, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.35', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.35, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:01] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:01] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=99
[2025-12-09 08:14:01] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:01] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:01] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:01] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:01] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:02] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.31', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.31, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.31', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.31, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:02] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:02] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:02] [ERROR] state_manager: BotState Ï†ÄÏû• Ïã§Ìå®: [Errno 2] No such file or directory: 'data/bot_state.json.tmp' -> 'data/bot_state.json'
[2025-12-09 08:14:02] [ERROR] state_manager: BotState Ï†ÄÏû• Ïã§Ìå®: [Errno 2] No such file or directory: 'data/bot_state.json.tmp' -> 'data/bot_state.json'
[2025-12-09 08:14:02] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.31', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.31, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.31', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.31, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:02] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:02] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=100
[2025-12-09 08:14:02] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:02] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:02] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:02] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:02] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:04] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.29', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.29, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.29', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.29, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:04] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:04] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:04] [ERROR] state_manager: BotState Ï†ÄÏû• Ïã§Ìå®: [Errno 2] No such file or directory: 'data/bot_state.json.tmp' -> 'data/bot_state.json'
[2025-12-09 08:14:04] [ERROR] state_manager: BotState Ï†ÄÏû• Ïã§Ìå®: [Errno 2] No such file or directory: 'data/bot_state.json.tmp' -> 'data/bot_state.json'
[2025-12-09 08:14:04] [ERROR] state_manager: BotState Ï†ÄÏû• Ïã§Ìå®: [Errno 2] No such file or directory: 'data/bot_state.json.tmp' -> 'data/bot_state.json'
[2025-12-09 08:14:04] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.29', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.29, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.29', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.29, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:04] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:04] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=101
[2025-12-09 08:14:04] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:04] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:04] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:04] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:04] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:05] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.24', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.24, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.24', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.24, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:05] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:05] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:05] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.24', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.24, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.24', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.24, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:05] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:05] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=102
[2025-12-09 08:14:05] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:05] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:05] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:05] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:05] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:06] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:06] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:06] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:07] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:07] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:07] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=103
[2025-12-09 08:14:07] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:07] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:07] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:07] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:07] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:08] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.12', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.12, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.12', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.12, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:08] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:08] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:08] [ERROR] state_manager: BotState Ï†ÄÏû• Ïã§Ìå®: [Errno 2] No such file or directory: 'data/bot_state.json.tmp' -> 'data/bot_state.json'
[2025-12-09 08:14:08] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.12', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.12, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.12', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.12, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:08] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:08] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=104
[2025-12-09 08:14:08] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:08] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:08] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:08] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:08] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:09] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.05', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.05, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.05', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.05, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:09] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:09] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:09] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.05', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.05, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.05', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.05, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:09] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:09] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=105
[2025-12-09 08:14:09] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:09] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:09] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:09] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:09] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:11] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.06', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.06, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.06', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.06, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:11] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:11] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:11] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.06', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.06, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.06', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.06, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:11] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:11] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=106
[2025-12-09 08:14:11] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:11] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:11] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:11] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:11] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:12] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.02', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.02, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90484.02', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90484.02, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:12] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:12] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:12] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90476.52', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90476.52, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90476.52', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90476.52, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:12] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:12] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=107
[2025-12-09 08:14:12] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:12] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:12] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:12] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:12] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:14] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90473.46', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90473.46, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90473.46', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90473.46, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:14] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:14] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:14] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90473.46', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90473.46, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90473.46', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90473.46, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:14] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:14] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=108
[2025-12-09 08:14:14] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:14] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:14] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:14] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:14] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:15] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90476.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90476.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90476.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90476.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:15] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:15] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:15] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90476.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90476.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90476.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90476.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:15] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:15] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=109
[2025-12-09 08:14:15] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:15] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:15] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:15] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:15] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:17] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:17] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:17] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:17] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:17] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:17] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=110
[2025-12-09 08:14:17] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:17] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:17] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:17] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:17] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:18] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90483.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90483.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90483.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90483.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:18] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:18] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:18] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90483.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90483.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90483.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90483.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:18] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:18] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=111
[2025-12-09 08:14:18] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:18] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:18] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:18] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:18] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:20] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90480', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90480.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90480', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90480.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:20] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:20] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:20] [ERROR] state_manager: BotState Ï†ÄÏû• Ïã§Ìå®: [Errno 2] No such file or directory: 'data/bot_state.json.tmp' -> 'data/bot_state.json'
[2025-12-09 08:14:20] [ERROR] state_manager: BotState Ï†ÄÏû• Ïã§Ìå®: [Errno 2] No such file or directory: 'data/bot_state.json.tmp' -> 'data/bot_state.json'
[2025-12-09 08:14:20] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90480', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90480.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90480', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90480.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:20] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:20] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=112
[2025-12-09 08:14:20] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:20] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:20] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:20] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:20] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:21] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:21] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:21] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:21] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:21] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:21] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=113
[2025-12-09 08:14:21] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:21] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:21] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:21] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:21] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:22] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:22] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:22] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:23] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:23] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:23] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=114
[2025-12-09 08:14:23] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:23] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:23] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:23] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:23] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:24] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:24] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:24] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:24] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:24] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:24] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=115
[2025-12-09 08:14:24] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:24] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:24] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:24] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:24] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:25] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:25] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:25] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:25] [ERROR] state_manager: BotState Ï†ÄÏû• Ïã§Ìå®: [Errno 2] No such file or directory: 'data/bot_state.json.tmp' -> 'data/bot_state.json'
[2025-12-09 08:14:25] [ERROR] state_manager: BotState Ï†ÄÏû• Ïã§Ìå®: [Errno 2] No such file or directory: 'data/bot_state.json.tmp' -> 'data/bot_state.json'
[2025-12-09 08:14:25] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:25] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:25] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=116
[2025-12-09 08:14:26] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:26] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:26] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:26] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:26] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:27] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:27] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:27] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:27] [ERROR] state_manager: BotState Ï†ÄÏû• Ïã§Ìå®: [Errno 2] No such file or directory: 'data/bot_state.json.tmp' -> 'data/bot_state.json'
[2025-12-09 08:14:27] [ERROR] state_manager: BotState Ï†ÄÏû• Ïã§Ìå®: [Errno 2] No such file or directory: 'data/bot_state.json.tmp' -> 'data/bot_state.json'
[2025-12-09 08:14:27] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:27] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:27] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=117
[2025-12-09 08:14:27] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:27] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:27] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:27] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:27] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:28] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:28] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:28] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:28] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:28] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:28] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=118
[2025-12-09 08:14:28] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:28] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:28] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:28] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:28] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:30] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:30] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:30] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:30] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:30] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:30] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=119
[2025-12-09 08:14:30] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:30] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:30] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:30] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:30] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:31] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:31] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:31] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:31] [ERROR] state_manager: BotState Ï†ÄÏû• Ïã§Ìå®: [Errno 2] No such file or directory: 'data/bot_state.json.tmp' -> 'data/bot_state.json'
[2025-12-09 08:14:31] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:31] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:31] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=120
[2025-12-09 08:14:31] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:31] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:31] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:31] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:31] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:33] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:33] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:33] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:33] [ERROR] state_manager: BotState Ï†ÄÏû• Ïã§Ìå®: [Errno 2] No such file or directory: 'data/bot_state.json.tmp' -> 'data/bot_state.json'
[2025-12-09 08:14:33] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:33] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:33] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=121
[2025-12-09 08:14:33] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:33] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:33] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:33] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:33] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:34] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:34] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:34] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:34] [ERROR] state_manager: BotState Ï†ÄÏû• Ïã§Ìå®: [Errno 2] No such file or directory: 'data/bot_state.json.tmp' -> 'data/bot_state.json'
[2025-12-09 08:14:34] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:34] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:34] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=122
[2025-12-09 08:14:34] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:34] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:34] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:34] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:34] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:36] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:36] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:36] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:36] [ERROR] state_manager: BotState Ï†ÄÏû• Ïã§Ìå®: [Errno 2] No such file or directory: 'data/bot_state.json.tmp' -> 'data/bot_state.json'
[2025-12-09 08:14:36] [ERROR] state_manager: BotState Ï†ÄÏû• Ïã§Ìå®: [Errno 2] No such file or directory: 'data/bot_state.json.tmp' -> 'data/bot_state.json'
[2025-12-09 08:14:36] [ERROR] state_manager: BotState Ï†ÄÏû• Ïã§Ìå®: [Errno 2] No such file or directory: 'data/bot_state.json.tmp' -> 'data/bot_state.json'
[2025-12-09 08:14:36] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:36] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:36] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=123
[2025-12-09 08:14:36] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:36] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:36] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:36] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:36] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:37] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:37] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:37] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:37] [ERROR] state_manager: BotState Ï†ÄÏû• Ïã§Ìå®: [Errno 2] No such file or directory: 'data/bot_state.json.tmp' -> 'data/bot_state.json'
[2025-12-09 08:14:37] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:37] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:37] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=124
[2025-12-09 08:14:37] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:37] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:37] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:37] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:37] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:38] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:38] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:38] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:39] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:39] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:39] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=125
[2025-12-09 08:14:39] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:39] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:39] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:39] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:39] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:40] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:40] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:40] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:40] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:40] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:40] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=126
[2025-12-09 08:14:40] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:40] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:40] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:40] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:40] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:41] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:41] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:41] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:41] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:41] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:41] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=127
[2025-12-09 08:14:42] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:42] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:42] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:42] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:42] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:43] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:43] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:43] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:43] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:43] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:43] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=128
[2025-12-09 08:14:43] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:43] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:43] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:43] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:43] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:44] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:44] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:44] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:44] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:44] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:44] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=129
[2025-12-09 08:14:44] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:44] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:44] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:44] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:44] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:46] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90467.09', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90467.09, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90467.09', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90467.09, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:46] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:46] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:46] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90467.09', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90467.09, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90467.09', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90467.09, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:46] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:46] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=130
[2025-12-09 08:14:46] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:46] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:46] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:46] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:46] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:47] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90465.62', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90465.62, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90465.62', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90465.62, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:47] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:47] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:47] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90465.25', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90465.25, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90465.25', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90465.25, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:47] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:47] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=131
[2025-12-09 08:14:47] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:47] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:47] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:47] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:47] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:49] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90465.24', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90465.24, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90465.24', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90465.24, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:49] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:49] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:49] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90465.24', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90465.24, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90465.24', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90465.24, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:49] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:49] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=132
[2025-12-09 08:14:49] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:49] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:49] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:49] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:49] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:50] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90456.55', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90456.55, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90456.55', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90456.55, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:50] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:50] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:50] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90456.55', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90456.55, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90456.55', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90456.55, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:50] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:50] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=133
[2025-12-09 08:14:50] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:50] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:50] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:50] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:50] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:52] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90456.76', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90456.76, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90456.76', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90456.76, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:52] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:52] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:52] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90456.76', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90456.76, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90456.76', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90456.76, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:52] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:52] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=134
[2025-12-09 08:14:52] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:52] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:52] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:52] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:52] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:53] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:53] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:53] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:53] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:53] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:53] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=135
[2025-12-09 08:14:53] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:53] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:53] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:53] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:53] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:54] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:54] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:55] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:55] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:55] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:55] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=136
[2025-12-09 08:14:55] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:55] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:55] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:55] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:55] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:56] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90455.83', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90455.83, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90455.83', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90455.83, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:56] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:56] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:56] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90455.83', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90455.83, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90455.83', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90455.83, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:56] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:56] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=137
[2025-12-09 08:14:56] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:56] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:56] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:56] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:56] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:57] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:57] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:57] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:58] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:58] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:58] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=138
[2025-12-09 08:14:58] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:58] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:58] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:58] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:58] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:14:59] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:59] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:59] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:59] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:14:59] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:14:59] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=139
[2025-12-09 08:14:59] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:14:59] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:14:59] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:14:59] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:14:59] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:00] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:00] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:00] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:00] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:00] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:00] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=140
[2025-12-09 08:15:00] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:00] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:00] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:00] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:00] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:02] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:02] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:02] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:02] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:02] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:02] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=141
[2025-12-09 08:15:02] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:02] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:02] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:02] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:02] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:03] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:03] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:03] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:03] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90457.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90457.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:03] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:03] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=142
[2025-12-09 08:15:03] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:03] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:03] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:03] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:03] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:05] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:05] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:05] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:05] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:05] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:05] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=143
[2025-12-09 08:15:05] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:05] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:05] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:05] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:05] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:06] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:06] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:06] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:06] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90463.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90463.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:06] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:06] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=144
[2025-12-09 08:15:06] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:06] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:06] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:06] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:06] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:08] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:08] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:08] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:08] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:08] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:08] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=145
[2025-12-09 08:15:08] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:08] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:08] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:08] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:08] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:09] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:09] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:09] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:09] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:09] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:09] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=146
[2025-12-09 08:15:09] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:09] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:09] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:09] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:09] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:11] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:11] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:11] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:11] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:11] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:11] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=147
[2025-12-09 08:15:11] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:11] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:11] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:11] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:11] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:12] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:12] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:12] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:12] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:12] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:12] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=148
[2025-12-09 08:15:12] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:12] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:12] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:12] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:12] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:13] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:13] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:13] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:14] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:14] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:14] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=149
[2025-12-09 08:15:14] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:14] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:14] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:14] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:14] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:15] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:15] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:15] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:15] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:15] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:15] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=150
[2025-12-09 08:15:15] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:15] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:15] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:15] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:15] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:16] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:16] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:16] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:16] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:16] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:16] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=151
[2025-12-09 08:15:16] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:16] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:16] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:16] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:16] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:18] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:18] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:18] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:18] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:18] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:18] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=152
[2025-12-09 08:15:18] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:18] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:18] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:18] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:18] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:19] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:19] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:19] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:19] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:19] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:19] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=153
[2025-12-09 08:15:19] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:19] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:19] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:19] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:19] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:21] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:21] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:21] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:21] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:21] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:21] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=154
[2025-12-09 08:15:21] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:21] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:21] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:21] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:21] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:22] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:22] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:22] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:22] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:22] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:22] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=155
[2025-12-09 08:15:22] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:22] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:22] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:22] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:22] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:24] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:24] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:24] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:24] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:24] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:24] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=156
[2025-12-09 08:15:24] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:24] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:24] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:24] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:24] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:25] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:25] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:25] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:25] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:25] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:25] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=157
[2025-12-09 08:15:25] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:25] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:25] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:25] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:25] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:27] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:27] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:27] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:27] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:27] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:27] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=158
[2025-12-09 08:15:27] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:27] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:27] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:27] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:27] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:28] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:28] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:28] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:28] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:28] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:28] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=159
[2025-12-09 08:15:28] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:28] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:28] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:28] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:28] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:29] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:29] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:29] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:30] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:30] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:30] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=160
[2025-12-09 08:15:30] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:30] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:30] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:30] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:30] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:31] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:31] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:31] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:31] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:31] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:31] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=161
[2025-12-09 08:15:31] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:31] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:31] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:31] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:31] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:32] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:32] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:32] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:32] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:32] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:32] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=162
[2025-12-09 08:15:33] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:33] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:33] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:33] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:33] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:34] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:34] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:34] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:34] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:34] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:34] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=163
[2025-12-09 08:15:34] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:34] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:34] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:34] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:34] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:35] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:35] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:35] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:35] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:35] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:35] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=164
[2025-12-09 08:15:35] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:35] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:35] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:35] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:35] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:37] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:37] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:37] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:37] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:37] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:37] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=165
[2025-12-09 08:15:37] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:37] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:37] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:37] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:37] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:38] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:38] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:38] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:38] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:38] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:38] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=166
[2025-12-09 08:15:38] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:38] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:38] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:38] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:38] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:40] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:40] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:40] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:40] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:40] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:40] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=167
[2025-12-09 08:15:40] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:40] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:40] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:40] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:40] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:41] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:41] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:41] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:41] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:41] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:41] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=168
[2025-12-09 08:15:41] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:41] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:41] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:41] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:41] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:43] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.54', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.54, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.54', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.54, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:43] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:43] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:43] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.54', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.54, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.54', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.54, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:43] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:43] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=169
[2025-12-09 08:15:43] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:43] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:43] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:43] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:43] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:44] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.59', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.59, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.59', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.59, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:44] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:44] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:44] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.59', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.59, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90478.59', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90478.59, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:44] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:44] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=170
[2025-12-09 08:15:44] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:44] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:44] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:44] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:44] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:45] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90481.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90481.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90481.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90481.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:45] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:45] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:46] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90481.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90481.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90481.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90481.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:46] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:46] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=171
[2025-12-09 08:15:46] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:46] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:46] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:46] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:46] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:47] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:47] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:47] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:47] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90482.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90482.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:47] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:47] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=172
[2025-12-09 08:15:47] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:47] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:47] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:47] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:47] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:48] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90495.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90495.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90495.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90495.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:48] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:48] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:48] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90495.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90495.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90495.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90495.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:48] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:48] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=173
[2025-12-09 08:15:49] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:49] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:49] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:49] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:49] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:50] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90497.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90497.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90497.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90497.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:50] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:50] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:50] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90497.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90497.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90497.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90497.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:50] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:50] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=174
[2025-12-09 08:15:50] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:50] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:50] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:50] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:50] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:51] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:51] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:51] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:51] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:51] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:51] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=175
[2025-12-09 08:15:51] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:51] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:51] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:51] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:51] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:53] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:53] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:53] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:53] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:53] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:53] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=176
[2025-12-09 08:15:53] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:53] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:53] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:53] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:53] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:54] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:54] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:54] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:54] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:54] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:54] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=177
[2025-12-09 08:15:54] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:54] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:54] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:54] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:54] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:56] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:56] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:56] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:56] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:56] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:56] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=178
[2025-12-09 08:15:56] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:56] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:56] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:56] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:56] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:57] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:57] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:57] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:57] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:57] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:57] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=179
[2025-12-09 08:15:57] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:57] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:57] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:57] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:57] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:15:59] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:59] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:59] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:59] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:15:59] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:15:59] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=180
[2025-12-09 08:15:59] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:15:59] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:15:59] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:15:59] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:15:59] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:00] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:00] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:00] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:00] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:00] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:00] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=181
[2025-12-09 08:16:00] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:00] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:00] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:00] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:00] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:01] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:01] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:01] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:02] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:02] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:02] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=182
[2025-12-09 08:16:02] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:02] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:02] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:02] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:02] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:03] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:03] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:03] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:03] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:03] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:03] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=183
[2025-12-09 08:16:03] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:03] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:03] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:03] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:03] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:04] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:04] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:04] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:04] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:04] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:04] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=184
[2025-12-09 08:16:05] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:05] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:05] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:05] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:05] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:06] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:06] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:06] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:06] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90498.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90498.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:06] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:06] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=185
[2025-12-09 08:16:06] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:06] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:06] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:06] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:06] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:07] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90499.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90499.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90499.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90499.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:07] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:07] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:07] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90499.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90499.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90499.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90499.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:07] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:07] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=186
[2025-12-09 08:16:07] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:07] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:07] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:07] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:07] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:09] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:09] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:09] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:09] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:09] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:09] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=187
[2025-12-09 08:16:09] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:09] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:09] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:09] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:09] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:10] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:10] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:10] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:10] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:10] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:10] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=188
[2025-12-09 08:16:10] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:10] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:10] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:10] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:10] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:12] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90516.13', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90516.13, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90516.13', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90516.13, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:12] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:12] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:12] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90516.13', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90516.13, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90516.13', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90516.13, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:12] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:12] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=189
[2025-12-09 08:16:12] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:12] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:12] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:12] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:12] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:13] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90516.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90516.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90516.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90516.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:13] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:13] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:13] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90514.71', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90514.71, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90514.71', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90514.71, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:13] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:13] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=190
[2025-12-09 08:16:13] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:13] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:13] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:13] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:13] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:15] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90514.69', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90514.69, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90514.69', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90514.69, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:15] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:15] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:15] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90514.69', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90514.69, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90514.69', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90514.69, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:15] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:15] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=191
[2025-12-09 08:16:15] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:15] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:15] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:15] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:15] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:16] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90514.77', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90514.77, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90514.77', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90514.77, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:16] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:16] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:16] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90514.77', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90514.77, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90514.77', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90514.77, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:16] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:16] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=192
[2025-12-09 08:16:16] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:16] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:16] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:16] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:16] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:17] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:17] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:17] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:18] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:18] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:18] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=193
[2025-12-09 08:16:18] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:18] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:18] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:18] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:18] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:19] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:19] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:19] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:19] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:19] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:19] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=194
[2025-12-09 08:16:19] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:19] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:19] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:19] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:19] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:20] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90524', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90524.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90524', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90524.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:20] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:20] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:20] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90524', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90524.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90524', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90524.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:20] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:20] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=195
[2025-12-09 08:16:21] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:21] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:21] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:21] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:21] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:22] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90524', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90524.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90524', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90524.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:22] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:22] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:22] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90524', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90524.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90524', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90524.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:22] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:22] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=196
[2025-12-09 08:16:22] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:22] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:22] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:22] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:22] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:23] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:23] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:23] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:23] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:23] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:23] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=197
[2025-12-09 08:16:23] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:23] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:23] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:23] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:23] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:25] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:25] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:25] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:25] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:25] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:25] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=198
[2025-12-09 08:16:25] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:25] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:25] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:25] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:25] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:26] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90514.17', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90514.17, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90514.17', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90514.17, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:26] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:26] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:26] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90514.17', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90514.17, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90514.17', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90514.17, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:26] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:26] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=199
[2025-12-09 08:16:26] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:26] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:26] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:26] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:26] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:28] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90519.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90519.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90519.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90519.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:28] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:28] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:28] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90519.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90519.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90519.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90519.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:28] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:28] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=200
[2025-12-09 08:16:28] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:28] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:28] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:28] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:28] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:29] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90519.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90519.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90519.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90519.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:29] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:29] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:29] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90519.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90519.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90519.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90519.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:29] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:29] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=201
[2025-12-09 08:16:29] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:29] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:29] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:29] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:29] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:31] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90518.92', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90518.92, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90518.92', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90518.92, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:31] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:31] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:31] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90518.92', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90518.92, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90518.92', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90518.92, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:31] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:31] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=202
[2025-12-09 08:16:31] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:31] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:31] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:31] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:31] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:32] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90518.79', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90518.79, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90518.79', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90518.79, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:32] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:32] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:32] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90518.79', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90518.79, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90518.79', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90518.79, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:32] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:32] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=203
[2025-12-09 08:16:32] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:32] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:32] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:32] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:32] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:33] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90519.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90519.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90519.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90519.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:33] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:33] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:34] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90519.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90519.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90519.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90519.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:34] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:34] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=204
[2025-12-09 08:16:34] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:34] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:34] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:34] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:34] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:35] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90519.24', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90519.24, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90519.24', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90519.24, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:35] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:35] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:35] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90519.24', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90519.24, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90519.24', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90519.24, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:35] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:35] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=205
[2025-12-09 08:16:35] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:35] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:35] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:35] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:35] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:36] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90521.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90521.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90521.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90521.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:36] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:36] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:37] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90521.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90521.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90521.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90521.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:37] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:37] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=206
[2025-12-09 08:16:37] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:37] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:37] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:37] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:37] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:38] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90526.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90526.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90526.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90526.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:38] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:38] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:38] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90526.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90526.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90526.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90526.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:38] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:38] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=207
[2025-12-09 08:16:38] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:38] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:38] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:38] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:38] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:39] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90533.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90533.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90533.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90533.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:39] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:39] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:39] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90533.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90533.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90533.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90533.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:39] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:39] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=208
[2025-12-09 08:16:39] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:39] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:39] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:39] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:39] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:41] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90533.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90533.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90533.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90533.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:41] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:41] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:41] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90533.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90533.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90533.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90533.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:41] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:41] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=209
[2025-12-09 08:16:41] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:41] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:41] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:41] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:41] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:42] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90533.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90533.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90533.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90533.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:42] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:42] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:42] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90533.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90533.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90533.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90533.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:42] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:42] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=210
[2025-12-09 08:16:42] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:42] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:42] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:42] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:42] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:44] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90533.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90533.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90533.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90533.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:44] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:44] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:44] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90533.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90533.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90533.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90533.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:44] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:44] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=211
[2025-12-09 08:16:44] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:44] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:44] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:44] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:44] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:45] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90533.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90533.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90533.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90533.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:45] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:45] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:45] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90533.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90533.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90533.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90533.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:45] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:45] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=212
[2025-12-09 08:16:45] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:45] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:45] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:45] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:45] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:47] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90534.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90534.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90534.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90534.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:47] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:47] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:47] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90534.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90534.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90534.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90534.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:47] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:47] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=213
[2025-12-09 08:16:47] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:47] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:47] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:47] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:47] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:48] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90534.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90534.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90534.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90534.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:48] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:48] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:48] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90534.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90534.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90534.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90534.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:48] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:48] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=214
[2025-12-09 08:16:48] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:48] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:48] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:48] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:48] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:49] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90534.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90534.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90534.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90534.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:49] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:49] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:50] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90534.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90534.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90534.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90534.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:50] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:50] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=215
[2025-12-09 08:16:50] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:50] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:50] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:50] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:50] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:51] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.87', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.87, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.87', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.87, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:51] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:51] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:51] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.87', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.87, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.87', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.87, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:51] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:51] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=216
[2025-12-09 08:16:51] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:51] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:51] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:51] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:51] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:52] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.88', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.88, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.88', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.88, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:52] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:52] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:52] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.88', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.88, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.88', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.88, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:52] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:52] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=217
[2025-12-09 08:16:53] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:53] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:53] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:53] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:53] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:54] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.87', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.87, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.87', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.87, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:54] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:54] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:54] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.87', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.87, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.87', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.87, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:54] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:54] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=218
[2025-12-09 08:16:54] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:54] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:54] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:54] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:54] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:55] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.84', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.84, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.84', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.84, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:55] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:55] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:55] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.85', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.85, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.85', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.85, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:55] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:55] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=219
[2025-12-09 08:16:55] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:55] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:55] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:55] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:55] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:57] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.83', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.83, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.83', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.83, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:57] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:57] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:57] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.83', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.83, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.83', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.83, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:57] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:57] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=220
[2025-12-09 08:16:57] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:57] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:57] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:57] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:57] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:16:58] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.76', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.76, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.76', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.76, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:58] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:58] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:58] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.76', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.76, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.76', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.76, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:16:58] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:16:58] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=221
[2025-12-09 08:16:58] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:16:58] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:16:58] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:16:58] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:16:58] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:00] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.76', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.76, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.76', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.76, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:00] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:00] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:00] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.76', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.76, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.76', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.76, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:00] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:00] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=222
[2025-12-09 08:17:00] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:00] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:00] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:00] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:00] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:01] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.75', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.75, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.75', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.75, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:01] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:01] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:01] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90532.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90532.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90532.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90532.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:01] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:01] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=223
[2025-12-09 08:17:01] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:01] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:01] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:01] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:01] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:03] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90532.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90532.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90532.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90532.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:03] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:03] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:03] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90532.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90532.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90532.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90532.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:03] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:03] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=224
[2025-12-09 08:17:03] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:03] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:03] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:03] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:03] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:04] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90532.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90532.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90532.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90532.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:04] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:04] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:04] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90532.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90532.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90532.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90532.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:04] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:04] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=225
[2025-12-09 08:17:04] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:04] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:04] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:04] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:04] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:05] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90535.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90535.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90535.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90535.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:05] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:05] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:06] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90535.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90535.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90535.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90535.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:06] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:06] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=226
[2025-12-09 08:17:06] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:06] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:06] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:06] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:06] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:07] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90535.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90535.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90535.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90535.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:07] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:07] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:07] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90535.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90535.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90535.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90535.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:07] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:07] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=227
[2025-12-09 08:17:07] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:07] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:07] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:07] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:07] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:08] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90535', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90535.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90535', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90535.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:08] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:08] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:08] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90535', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90535.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90535', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90535.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:08] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:08] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=228
[2025-12-09 08:17:09] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:09] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:09] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:09] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:09] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:10] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:10] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:10] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:10] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:10] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:10] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=229
[2025-12-09 08:17:10] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:10] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:10] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:10] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:10] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:11] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:11] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:11] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:11] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:11] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:11] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=230
[2025-12-09 08:17:11] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:11] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:11] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:11] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:11] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:13] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:13] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:13] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:13] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:13] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:13] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=231
[2025-12-09 08:17:13] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:13] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:13] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:13] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:13] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:14] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:14] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:14] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:14] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:14] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:14] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=232
[2025-12-09 08:17:14] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:14] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:14] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:14] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:14] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:16] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:16] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:16] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:16] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:16] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:16] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=233
[2025-12-09 08:17:16] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:16] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:16] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:16] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:16] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:17] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90535.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90535.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90535.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90535.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:17] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:17] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:17] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90535.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90535.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90535.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90535.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:17] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:17] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=234
[2025-12-09 08:17:17] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:17] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:17] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:17] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:17] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:19] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90534.84', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90534.84, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90534.84', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90534.84, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:19] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:19] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:19] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90534.84', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90534.84, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90534.84', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90534.84, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:19] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:19] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=235
[2025-12-09 08:17:19] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:19] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:19] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:19] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:19] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:20] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90531.84', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90531.84, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90531.84', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90531.84, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:20] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:20] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:20] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90531.84', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90531.84, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90531.84', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90531.84, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:20] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:20] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=236
[2025-12-09 08:17:20] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:20] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:20] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:20] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:20] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:21] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.72', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.72, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.72', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.72, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:21] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:21] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:22] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.72', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.72, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.72', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.72, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:22] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:22] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=237
[2025-12-09 08:17:22] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:22] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:22] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:22] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:22] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:23] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.09', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.09, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.09', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.09, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:23] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:23] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:23] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.09', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.09, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528.09', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.09, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:23] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:23] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=238
[2025-12-09 08:17:23] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:23] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:23] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:23] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:23] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:24] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90527.75', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90527.75, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90527.75', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90527.75, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:24] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:24] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:24] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90527.75', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90527.75, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90527.75', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90527.75, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:24] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:24] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=239
[2025-12-09 08:17:25] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:25] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:25] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:25] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:25] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:26] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90527.75', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90527.75, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90527.75', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90527.75, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:26] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:26] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:26] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90527.75', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90527.75, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90527.75', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90527.75, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:26] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:26] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=240
[2025-12-09 08:17:26] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:26] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:26] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:26] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:26] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:27] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90532', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90532.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90532', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90532.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:27] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:27] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:27] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90532', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90532.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90532', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90532.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:27] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:27] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=241
[2025-12-09 08:17:27] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:27] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:27] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:27] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:27] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:29] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90529.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90529.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90529.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90529.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:29] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:29] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:29] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90529.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90529.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90529.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90529.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:29] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:29] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=242
[2025-12-09 08:17:29] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:29] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:29] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:29] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:29] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:30] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90529', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90529.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90529', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90529.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:30] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:30] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:30] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90529', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90529.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90529', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90529.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:30] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:30] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=243
[2025-12-09 08:17:30] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:30] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:30] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:30] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:30] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:32] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90524.28', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90524.28, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90524.28', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90524.28, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:32] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:32] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:32] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90524.28', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90524.28, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90524.28', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90524.28, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:32] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:32] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=244
[2025-12-09 08:17:32] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:32] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:32] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:32] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:32] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:33] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:33] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:33] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:33] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:33] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:33] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=245
[2025-12-09 08:17:33] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:33] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:33] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:33] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:33] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:35] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90526.29', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90526.29, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90526.29', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90526.29, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:35] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:35] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:35] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90526.29', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90526.29, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90526.29', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90526.29, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:35] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:35] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=246
[2025-12-09 08:17:35] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:35] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:35] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:35] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:35] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:36] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:36] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:36] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:36] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:36] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:36] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=247
[2025-12-09 08:17:36] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:36] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:36] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:36] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:36] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:37] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:37] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:37] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:38] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:38] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:38] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=248
[2025-12-09 08:17:38] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:38] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:38] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:38] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:38] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:39] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:39] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:39] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:39] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:39] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:39] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=249
[2025-12-09 08:17:39] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:39] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:39] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:39] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:39] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:40] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:40] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:40] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:40] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:40] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:40] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=250
[2025-12-09 08:17:41] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:41] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:41] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:41] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:41] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:42] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90554.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90554.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90554.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90554.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:42] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:42] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:42] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90554.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90554.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90554.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90554.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:42] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:42] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=251
[2025-12-09 08:17:42] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:42] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:42] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:42] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:42] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:43] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90554.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90554.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90554.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90554.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:43] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:43] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:43] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90554.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90554.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90554.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90554.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:43] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:43] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=252
[2025-12-09 08:17:43] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:43] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:43] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:43] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:43] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:45] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90554.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90554.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90554.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90554.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:45] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:45] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:45] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90554.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90554.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90554.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90554.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:45] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:45] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=253
[2025-12-09 08:17:45] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:45] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:45] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:45] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:45] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:46] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90554.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90554.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90554.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90554.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:46] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:46] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:46] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90541.95', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90541.95, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90541.95', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90541.95, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:46] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:46] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=254
[2025-12-09 08:17:46] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:46] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:46] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:46] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:46] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:48] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90541.57', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90541.57, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90541.57', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90541.57, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:48] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:48] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:48] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90541.57', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90541.57, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90541.57', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90541.57, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:48] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:48] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=255
[2025-12-09 08:17:48] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:48] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:48] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:48] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:48] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:49] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90541.56', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90541.56, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90541.56', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90541.56, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:49] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:49] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:49] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90541.56', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90541.56, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90541.56', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90541.56, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:49] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:49] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=256
[2025-12-09 08:17:49] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:49] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:49] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:49] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:49] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:51] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.79', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.79, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.79', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.79, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:51] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:51] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:51] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.79', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.79, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.79', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.79, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:51] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:51] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=257
[2025-12-09 08:17:51] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:51] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:51] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:51] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:51] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:52] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.75', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.75, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.75', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.75, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:52] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:52] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:52] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.75', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.75, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.75', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.75, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:52] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:52] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=258
[2025-12-09 08:17:52] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:52] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:52] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:52] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:52] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:53] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.73', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.73, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.73', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.73, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:53] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:53] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:54] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.73', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.73, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.73', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.73, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:54] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:54] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=259
[2025-12-09 08:17:54] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:54] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:54] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:54] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:54] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:55] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.73', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.73, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.73', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.73, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:55] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:55] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:55] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.73', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.73, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.73', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.73, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:55] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:55] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=260
[2025-12-09 08:17:55] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:55] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:55] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:55] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:55] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:56] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.21', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.21, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.21', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.21, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:56] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:56] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:56] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.21', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.21, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.21', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.21, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:56] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:56] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=261
[2025-12-09 08:17:56] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:56] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:56] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:56] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:56] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:17:56] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:58] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90535.69', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90535.69, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90535.69', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90535.69, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:58] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:58] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:58] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90535.69', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90535.69, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90535.69', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90535.69, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:58] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:58] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=262
[2025-12-09 08:17:58] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:58] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:58] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:58] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:58] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:17:58] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:17:59] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90535.64', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90535.64, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90535.64', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90535.64, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:59] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:59] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:59] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90535.61', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90535.61, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90535.61', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90535.61, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:17:59] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:17:59] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=263
[2025-12-09 08:17:59] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:17:59] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:17:59] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:17:59] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:17:59] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:17:59] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:01] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:01] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:01] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:01] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:01] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:01] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=264
[2025-12-09 08:18:01] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:01] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:01] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:01] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:01] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:01] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:02] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:02] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:02] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:02] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:02] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:02] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=265
[2025-12-09 08:18:02] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:02] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:02] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:02] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:02] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:02] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:04] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:04] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:04] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:04] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:04] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:04] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=266
[2025-12-09 08:18:04] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:04] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:04] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:04] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:04] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:04] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:05] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:05] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:05] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:05] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:05] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:05] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=267
[2025-12-09 08:18:05] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:05] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:05] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:05] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:05] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:05] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:07] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:07] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:07] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:07] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:07] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:07] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=268
[2025-12-09 08:18:07] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:07] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:07] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:07] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:07] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:07] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:08] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:08] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:08] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:08] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:08] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:08] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=269
[2025-12-09 08:18:08] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:08] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:08] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:08] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:08] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:08] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:10] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:10] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:10] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:10] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:10] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:10] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=270
[2025-12-09 08:18:10] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:10] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:10] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:10] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:10] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:10] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:11] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:11] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:11] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:11] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:11] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:11] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=271
[2025-12-09 08:18:11] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:11] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:11] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:11] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:11] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:11] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:12] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90531.46', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90531.46, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90531.46', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90531.46, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:12] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:12] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:13] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90531.46', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90531.46, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90531.46', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90531.46, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:13] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:13] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=272
[2025-12-09 08:18:13] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:13] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:13] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:13] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:13] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:13] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:14] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90530.21', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90530.21, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90530.21', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90530.21, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:14] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:14] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:14] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90530.21', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90530.21, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90530.21', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90530.21, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:14] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:14] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=273
[2025-12-09 08:18:14] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:14] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:14] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:14] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:14] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:14] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:15] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90530', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90530.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90530', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90530.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:15] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:15] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:15] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90530', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90530.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90530', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90530.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:15] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:15] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=274
[2025-12-09 08:18:16] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:16] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:16] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:16] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:16] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:16] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:17] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90533.39', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90533.39, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90533.39', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90533.39, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:17] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:17] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:17] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90533.39', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90533.39, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90533.39', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90533.39, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:17] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:17] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=275
[2025-12-09 08:18:17] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:17] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:17] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:17] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:17] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:17] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:18] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:18] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:18] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:18] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:18] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:18] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=276
[2025-12-09 08:18:18] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:18] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:18] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:18] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:18] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:18] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:20] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:20] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:20] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:20] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:20] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:20] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=277
[2025-12-09 08:18:20] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:20] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:20] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:20] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:20] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:20] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:21] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:21] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:21] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:21] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:21] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:21] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=278
[2025-12-09 08:18:21] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:21] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:21] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:21] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:21] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:21] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:23] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:23] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:23] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:23] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:23] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:23] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=279
[2025-12-09 08:18:23] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:23] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:23] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:23] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:23] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:23] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:24] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90533.32', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90533.32, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90533.32', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90533.32, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:24] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:24] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:24] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90533.32', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90533.32, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90533.32', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90533.32, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:24] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:24] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=280
[2025-12-09 08:18:24] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:24] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:24] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:24] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:24] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:24] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:26] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90527.27', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90527.27, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90527.27', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90527.27, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:26] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:26] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:26] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90527.27', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90527.27, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90527.27', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90527.27, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:26] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:26] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=281
[2025-12-09 08:18:26] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:26] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:26] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:26] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:26] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:26] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:27] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90525.57', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90525.57, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90525.57', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90525.57, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:27] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:27] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:27] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90525.57', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90525.57, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90525.57', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90525.57, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:27] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:27] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=282
[2025-12-09 08:18:27] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:27] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:27] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:27] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:27] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:27] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:28] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90525.41', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90525.41, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90525.41', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90525.41, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:28] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:28] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:29] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90525.41', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90525.41, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90525.41', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90525.41, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:29] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:29] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=283
[2025-12-09 08:18:29] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:29] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:29] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:29] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:29] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:29] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:30] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90525.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90525.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90525.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90525.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:30] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:30] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:30] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90525.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90525.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90525.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90525.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:30] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:30] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=284
[2025-12-09 08:18:30] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:30] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:30] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:30] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:30] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:30] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:31] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90525.19', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90525.19, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90525.19', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90525.19, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:31] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:31] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:31] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90525.19', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90525.19, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90525.19', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90525.19, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:31] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:31] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=285
[2025-12-09 08:18:32] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:32] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:32] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:32] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:32] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:32] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:33] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90525.16', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90525.16, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90525.16', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90525.16, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:33] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:33] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:33] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90525.16', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90525.16, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90525.16', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90525.16, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:33] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:33] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=286
[2025-12-09 08:18:33] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:33] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:33] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:33] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:33] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:33] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:34] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90525.09', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90525.09, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90525.09', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90525.09, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:34] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:34] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:34] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90525.09', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90525.09, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90525.09', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90525.09, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:34] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:34] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=287
[2025-12-09 08:18:34] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:34] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:34] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:34] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:34] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:34] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:36] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90525.06', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90525.06, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90525.06', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90525.06, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:36] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:36] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:36] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90525.06', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90525.06, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90525.06', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90525.06, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:36] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:36] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=288
[2025-12-09 08:18:36] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:36] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:36] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:36] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:36] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:36] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:37] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90524.88', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90524.88, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90524.88', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90524.88, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:37] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:37] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:37] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90524.84', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90524.84, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90524.84', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90524.84, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:37] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:37] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=289
[2025-12-09 08:18:37] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:37] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:37] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:37] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:37] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:37] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:39] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90524.63', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90524.63, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90524.63', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90524.63, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:39] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:39] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:39] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90524.63', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90524.63, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90524.63', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90524.63, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:39] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:39] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=290
[2025-12-09 08:18:39] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:39] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:39] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:39] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:39] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:39] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:40] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90524.51', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90524.51, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90524.51', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90524.51, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:40] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:40] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:40] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90524.51', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90524.51, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90524.51', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90524.51, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:40] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:40] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=291
[2025-12-09 08:18:40] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:40] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:40] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:40] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:40] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:40] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:42] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90524.24', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90524.24, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90524.24', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90524.24, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:42] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:42] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:42] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90524.24', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90524.24, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90524.24', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90524.24, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:42] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:42] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=292
[2025-12-09 08:18:42] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:42] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:42] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:42] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:42] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:42] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:43] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.95', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.95, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.95', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.95, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:43] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:43] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:43] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.95', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.95, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.95', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.95, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:43] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:43] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=293
[2025-12-09 08:18:43] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:43] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:43] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:43] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:43] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:43] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:44] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:44] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:44] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:45] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:45] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:45] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=294
[2025-12-09 08:18:45] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:45] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:45] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:45] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:45] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:45] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:46] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.91', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.91, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.91', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.91, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:46] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:46] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:46] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.91', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.91, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.91', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.91, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:46] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:46] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=295
[2025-12-09 08:18:46] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:46] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:46] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:46] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:46] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:46] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:47] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.77', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.77, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.77', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.77, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:47] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:47] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:48] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.77', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.77, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.77', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.77, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:48] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:48] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=296
[2025-12-09 08:18:48] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:48] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:48] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:48] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:48] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:48] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:49] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.67', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.67, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.67', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.67, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:49] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:49] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:49] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.67', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.67, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.67', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.67, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:49] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:49] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=297
[2025-12-09 08:18:49] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:49] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:49] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:49] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:49] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:49] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:50] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:50] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:50] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:50] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.56', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.56, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.56', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.56, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:50] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:50] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=298
[2025-12-09 08:18:50] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:50] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:50] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:50] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:50] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:50] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:52] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.47', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.47, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.47', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.47, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:52] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:52] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:52] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.47', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.47, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.47', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.47, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:52] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:52] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=299
[2025-12-09 08:18:52] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:52] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:52] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:52] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:52] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:52] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:53] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.36', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.36, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.36', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.36, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:53] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:53] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:53] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.36', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.36, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.36', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.36, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:53] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:53] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=300
[2025-12-09 08:18:53] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:53] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:53] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:53] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:53] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:53] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:55] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.31', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.31, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.31', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.31, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:55] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:55] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:55] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.31', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.31, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.31', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.31, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:55] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:55] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=301
[2025-12-09 08:18:55] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:55] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:55] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:55] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:55] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:55] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:56] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.38', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.38, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.38', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.38, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:56] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:56] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:56] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.36', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.36, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.36', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.36, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:56] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:56] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=302
[2025-12-09 08:18:56] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:56] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:56] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:56] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:56] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:56] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:58] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.33', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.33, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.33', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.33, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:58] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:58] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:58] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.33', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.33, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.33', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.33, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:58] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:58] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=303
[2025-12-09 08:18:58] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:58] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:58] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:58] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:58] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:58] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:18:59] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.25', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.25, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.25', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.25, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:59] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:59] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:59] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.25', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.25, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.25', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.25, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:18:59] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:18:59] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=304
[2025-12-09 08:18:59] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:18:59] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:18:59] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:18:59] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:18:59] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:18:59] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:00] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:00] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:01] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:01] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:01] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:01] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=305
[2025-12-09 08:19:01] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:01] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:01] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:01] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:01] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:01] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:02] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90529.59', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90529.59, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90529.59', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90529.59, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:02] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:02] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:02] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90529.59', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90529.59, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90529.59', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90529.59, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:02] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:02] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=306
[2025-12-09 08:19:02] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:02] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:02] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:02] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:02] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:02] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:03] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90536.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90536.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90536.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90536.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:03] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:03] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:04] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90536.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90536.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90536.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90536.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:04] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:04] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=307
[2025-12-09 08:19:04] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:04] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:04] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:04] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:04] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:04] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:05] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:05] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:05] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:05] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:05] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:05] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=308
[2025-12-09 08:19:05] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:05] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:05] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:05] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:05] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:05] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:06] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:06] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:06] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:06] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:06] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:06] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=309
[2025-12-09 08:19:06] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:06] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:06] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:06] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:06] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:06] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:08] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:08] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:08] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:08] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:08] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:08] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=310
[2025-12-09 08:19:08] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:08] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:08] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:08] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:08] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:08] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:09] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:09] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:09] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:09] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:09] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:09] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=311
[2025-12-09 08:19:09] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:09] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:09] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:09] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:09] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:09] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:11] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:11] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:11] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:11] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:11] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:11] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=312
[2025-12-09 08:19:11] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:11] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:11] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:11] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:11] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:11] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:12] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:12] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:12] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:12] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:12] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:12] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=313
[2025-12-09 08:19:12] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:12] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:12] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:12] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:12] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:12] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:14] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:14] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:14] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:14] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:14] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:14] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=314
[2025-12-09 08:19:14] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:14] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:14] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:14] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:14] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:14] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:15] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:15] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:15] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:15] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:15] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:15] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=315
[2025-12-09 08:19:15] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:15] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:15] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:15] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:15] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:15] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:16] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:16] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:17] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:17] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:17] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:17] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=316
[2025-12-09 08:19:17] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:17] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:17] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:17] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:17] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:17] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:18] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:18] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:18] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:18] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:18] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:18] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=317
[2025-12-09 08:19:18] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:18] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:18] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:18] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:18] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:18] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:19] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:19] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:19] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:20] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:20] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:20] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=318
[2025-12-09 08:19:20] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:20] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:20] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:20] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:20] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:20] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:21] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:21] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:21] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:21] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:21] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:21] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=319
[2025-12-09 08:19:21] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:21] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:21] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:21] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:21] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:21] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:22] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:22] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:22] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:22] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:22] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:22] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=320
[2025-12-09 08:19:22] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:22] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:22] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:22] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:22] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:22] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:24] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90540.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90540.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90540.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90540.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:24] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:24] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:24] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90540.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90540.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90540.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90540.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:24] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:24] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=321
[2025-12-09 08:19:24] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:24] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:24] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:24] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:24] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:24] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:25] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90548', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90548.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90548', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90548.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:25] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:25] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:25] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90543.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90543.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90543.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90543.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:25] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:25] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=322
[2025-12-09 08:19:25] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:25] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:25] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:25] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:25] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:25] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:27] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90543.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90543.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90543.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90543.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:27] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:27] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:27] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90543.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90543.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90543.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90543.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:27] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:27] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=323
[2025-12-09 08:19:27] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:27] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:27] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:27] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:27] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:27] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:28] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90543.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90543.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90543.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90543.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:28] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:28] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:28] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90543.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90543.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90543.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90543.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:28] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:28] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=324
[2025-12-09 08:19:28] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:28] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:28] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:28] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:28] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:28] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:30] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90543.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90543.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90543.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90543.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:30] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:30] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:30] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90543.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90543.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90543.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90543.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:30] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:30] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=325
[2025-12-09 08:19:30] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:30] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:30] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:30] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:30] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:30] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:31] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90543.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90543.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90543.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90543.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:31] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:31] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:31] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90543.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90543.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90543.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90543.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:31] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:31] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=326
[2025-12-09 08:19:31] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:31] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:31] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:31] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:31] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:31] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:32] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:32] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:32] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:33] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:33] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:33] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=327
[2025-12-09 08:19:33] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:33] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:33] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:33] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:33] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:33] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:34] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:34] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:34] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:34] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:34] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:34] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=328
[2025-12-09 08:19:34] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:34] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:34] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:34] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:34] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:34] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:35] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:35] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:35] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:36] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:36] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:36] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=329
[2025-12-09 08:19:36] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:36] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:36] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:36] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:36] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:36] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:37] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:37] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:37] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:37] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:37] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:37] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=330
[2025-12-09 08:19:37] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:37] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:37] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:37] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:37] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:37] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:38] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:38] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:38] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:38] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:38] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:38] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=331
[2025-12-09 08:19:38] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:38] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:38] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:38] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:38] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:38] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:40] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:40] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:40] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:40] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:40] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:40] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=332
[2025-12-09 08:19:40] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:40] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:40] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:40] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:40] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:40] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:41] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:41] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:41] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:41] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:41] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:41] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=333
[2025-12-09 08:19:41] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:41] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:41] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:41] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:41] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:41] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:43] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:43] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:43] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:43] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:43] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:43] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=334
[2025-12-09 08:19:43] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:43] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:43] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:43] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:43] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:43] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:44] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:44] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:44] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:44] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:44] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:44] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=335
[2025-12-09 08:19:44] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:44] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:44] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:44] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:44] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:44] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:46] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:46] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:46] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:46] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:46] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:46] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=336
[2025-12-09 08:19:46] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:46] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:46] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:46] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:46] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:46] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:47] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:47] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:47] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:47] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:47] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:47] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=337
[2025-12-09 08:19:47] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:47] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:47] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:47] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:47] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:47] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:48] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:48] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:48] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:49] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:49] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:49] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=338
[2025-12-09 08:19:49] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:49] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:49] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:49] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:49] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:49] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:50] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:50] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:50] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:50] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:50] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:50] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=339
[2025-12-09 08:19:50] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:50] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:50] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:50] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:50] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:50] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:51] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:51] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:51] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:51] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:51] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:51] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=340
[2025-12-09 08:19:52] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:52] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:52] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:52] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:52] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:52] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:53] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:53] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:53] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:53] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:53] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:53] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=341
[2025-12-09 08:19:53] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:53] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:53] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:53] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:53] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:53] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:54] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:54] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:54] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:54] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:54] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:54] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=342
[2025-12-09 08:19:54] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:54] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:54] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:54] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:54] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:54] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:56] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:56] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:56] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:56] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:56] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:56] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=343
[2025-12-09 08:19:56] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:56] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:56] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:56] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:56] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:56] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:57] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90550.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90550.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90550.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90550.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:57] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:57] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:57] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90550.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90550.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90550.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90550.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:57] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:57] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=344
[2025-12-09 08:19:57] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:57] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:57] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:57] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:57] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:57] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:19:59] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90552.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90552.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90552.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90552.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:59] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:59] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:59] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90552.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90552.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90552.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90552.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:19:59] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:19:59] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=345
[2025-12-09 08:19:59] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:19:59] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:19:59] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:19:59] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:19:59] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:19:59] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:00] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90552.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90552.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90552.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90552.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:00] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:00] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:00] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:00] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:00] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=346
[2025-12-09 08:20:00] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:00] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:00] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:00] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:00] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:00] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:02] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:02] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:02] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:02] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:02] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:02] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=347
[2025-12-09 08:20:02] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:02] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:02] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:02] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:02] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:02] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:03] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:03] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:03] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:03] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:03] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:03] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=348
[2025-12-09 08:20:03] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:03] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:03] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:03] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:03] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:03] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:04] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:04] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:04] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:05] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:05] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:05] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=349
[2025-12-09 08:20:05] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:05] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:05] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:05] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:05] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:05] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:06] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:06] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:06] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:06] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:06] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:06] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=350
[2025-12-09 08:20:06] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:06] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:06] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:06] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:06] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:06] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:07] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.68', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.68, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.68', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.68, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:07] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:07] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:07] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.68', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.68, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.68', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.68, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:07] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:07] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=351
[2025-12-09 08:20:08] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:08] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:08] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:08] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:08] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:08] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:09] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.62', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.62, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.62', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.62, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:09] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:09] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:09] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.62', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.62, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.62', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.62, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:09] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:09] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=352
[2025-12-09 08:20:09] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:09] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:09] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:09] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:09] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:09] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:10] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.47', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.47, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.47', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.47, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:10] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:10] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:10] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.47', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.47, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.47', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.47, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:10] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:10] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=353
[2025-12-09 08:20:10] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:10] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:10] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:10] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:10] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:10] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:12] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.84', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.84, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.84', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.84, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:12] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:12] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:12] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.84', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.84, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.84', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.84, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:12] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:12] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=354
[2025-12-09 08:20:12] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:12] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:12] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:12] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:12] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:12] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:13] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.68', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.68, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.68', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.68, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:13] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:13] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:13] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.57', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.57, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.57', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.57, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:13] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:13] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=355
[2025-12-09 08:20:13] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:13] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:13] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:13] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:13] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:13] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:15] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.44', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.44, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.44', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.44, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:15] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:15] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:15] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.44', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.44, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.44', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.44, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:15] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:15] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=356
[2025-12-09 08:20:15] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:15] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:15] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:15] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:15] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:15] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:16] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.34', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.34, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.34', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.34, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:16] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:16] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:16] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.34', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.34, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.34', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.34, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:16] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:16] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=357
[2025-12-09 08:20:16] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:16] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:16] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:16] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:16] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:16] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:18] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.38', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.38, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.38', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.38, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:18] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:18] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:18] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.38', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.38, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.38', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.38, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:18] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:18] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=358
[2025-12-09 08:20:18] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:18] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:18] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:18] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:18] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:18] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:19] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.37', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.37, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.37', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.37, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:19] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:19] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:19] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.37', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.37, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.37', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.37, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:19] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:19] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=359
[2025-12-09 08:20:19] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:19] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:19] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:19] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:19] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:19] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:20] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.98', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.98, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.98', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.98, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:20] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:21] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:21] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.98', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.98, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.98', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.98, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:21] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:21] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=360
[2025-12-09 08:20:21] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:21] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:21] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:21] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:21] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:21] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:22] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.99', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.99, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.99', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.99, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:22] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:22] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:22] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.99', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.99, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.99', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.99, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:22] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:22] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=361
[2025-12-09 08:20:22] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:22] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:22] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:22] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:22] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:22] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:23] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:23] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:23] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:24] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:24] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:24] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=362
[2025-12-09 08:20:24] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:24] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:24] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:24] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:24] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:24] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:25] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:25] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:25] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:25] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:25] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:25] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=363
[2025-12-09 08:20:25] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:25] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:25] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:25] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:25] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:25] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:26] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:26] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:26] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:26] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:26] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:26] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=364
[2025-12-09 08:20:27] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:27] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:27] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:27] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:27] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:27] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:28] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539.04', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.04, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539.04', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.04, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:28] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:28] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:28] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539.04', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.04, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539.04', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.04, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:28] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:28] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=365
[2025-12-09 08:20:28] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:28] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:28] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:28] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:28] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:28] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:29] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539.09', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.09, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539.09', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.09, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:29] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:29] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:29] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539.09', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.09, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539.09', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.09, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:29] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:29] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=366
[2025-12-09 08:20:29] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:29] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:29] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:29] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:29] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:29] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:31] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539.04', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.04, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539.04', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.04, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:31] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:31] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:31] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539.04', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.04, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539.04', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.04, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:31] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:31] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=367
[2025-12-09 08:20:31] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:31] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:31] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:31] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:31] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:31] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:32] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.97', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.97, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.97', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.97, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:32] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:32] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:32] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.93', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.93, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.93', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.93, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:32] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:32] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=368
[2025-12-09 08:20:32] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:32] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:32] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:32] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:32] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:32] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:34] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.84', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.84, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.84', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.84, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:34] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:34] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:34] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.84', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.84, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.84', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.84, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:34] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:34] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=369
[2025-12-09 08:20:34] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:34] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:34] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:34] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:34] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:34] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:35] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.79', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.79, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.79', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.79, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:35] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:35] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:35] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.79', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.79, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.79', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.79, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:35] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:35] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=370
[2025-12-09 08:20:35] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:35] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:35] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:35] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:35] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:35] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:37] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.18', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.18, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.18', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.18, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:37] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:37] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:37] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.18', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.18, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.18', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.18, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:37] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:37] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=371
[2025-12-09 08:20:37] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:37] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:37] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:37] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:37] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:37] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:38] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.14', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.14, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.14', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.14, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:38] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:38] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:38] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.14', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.14, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.14', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.14, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:38] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:38] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=372
[2025-12-09 08:20:38] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:38] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:38] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:38] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:38] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:38] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:39] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.45', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.45, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.45', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.45, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:39] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:39] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:40] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.45', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.45, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.45', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.45, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:40] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:40] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=373
[2025-12-09 08:20:40] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:40] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:40] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:40] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:40] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:40] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:41] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.42', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.42, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.42', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.42, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:41] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:41] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:41] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.42', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.42, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.42', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.42, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:41] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:41] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=374
[2025-12-09 08:20:41] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:41] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:41] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:41] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:41] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:41] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:42] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:42] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:42] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:42] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:42] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:42] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=375
[2025-12-09 08:20:43] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:43] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:43] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:43] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:43] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:43] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:44] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.59', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.59, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.59', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.59, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:44] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:44] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:44] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.59', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.59, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.59', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.59, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:44] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:44] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=376
[2025-12-09 08:20:44] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:44] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:44] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:44] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:44] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:44] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:45] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:45] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:45] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:45] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:45] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:45] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=377
[2025-12-09 08:20:45] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:45] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:45] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:45] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:45] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:45] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:47] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:47] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:47] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:47] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:47] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:47] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=378
[2025-12-09 08:20:47] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:47] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:47] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:47] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:47] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:47] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:48] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:48] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:48] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:48] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:48] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:48] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=379
[2025-12-09 08:20:48] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:48] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:48] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:48] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:48] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:48] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:50] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:50] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:50] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:50] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:50] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:50] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=380
[2025-12-09 08:20:50] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:50] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:50] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:50] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:50] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:50] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:51] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:51] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:51] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:51] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:51] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:51] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=381
[2025-12-09 08:20:51] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:51] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:51] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:51] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:51] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:51] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:53] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:53] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:53] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:53] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:53] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:53] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=382
[2025-12-09 08:20:53] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:53] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:53] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:53] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:53] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:53] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:54] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:54] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:54] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:54] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:54] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:54] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=383
[2025-12-09 08:20:54] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:54] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:54] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:54] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:54] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:54] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:55] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:55] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:55] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:56] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:56] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:56] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=384
[2025-12-09 08:20:56] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:56] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:56] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:56] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:56] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:56] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:57] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:57] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:57] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:57] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:57] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:57] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=385
[2025-12-09 08:20:57] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:57] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:57] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:57] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:57] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:57] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:20:58] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:58] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:58] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:58] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:20:58] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:20:58] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=386
[2025-12-09 08:20:59] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:20:59] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:20:59] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:20:59] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:20:59] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:20:59] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:00] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:00] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:00] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:00] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:00] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:00] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=387
[2025-12-09 08:21:00] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:00] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:00] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:00] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:00] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:00] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:01] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:01] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:01] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:02] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:02] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:02] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=388
[2025-12-09 08:21:02] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:02] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:02] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:02] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:02] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:02] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:03] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:03] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:03] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:03] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:03] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:03] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=389
[2025-12-09 08:21:03] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:03] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:03] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:03] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:03] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:03] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:05] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:05] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:05] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:05] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:05] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:05] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=390
[2025-12-09 08:21:05] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:05] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:05] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:05] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:05] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:05] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:06] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:06] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:06] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:06] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:06] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:06] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=391
[2025-12-09 08:21:06] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:06] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:06] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:06] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:06] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:06] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:08] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:08] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:08] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:08] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:08] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:08] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=392
[2025-12-09 08:21:08] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:08] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:08] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:08] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:08] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:08] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:09] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:09] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:09] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:09] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:09] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:09] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=393
[2025-12-09 08:21:09] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:09] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:09] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:09] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:09] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:09] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:10] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:10] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:10] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:11] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:11] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:11] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=394
[2025-12-09 08:21:11] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:11] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:11] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:11] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:11] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:11] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:12] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:12] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:12] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:12] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:12] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:12] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=395
[2025-12-09 08:21:12] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:12] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:12] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:12] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:12] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:12] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:13] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:13] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:13] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:14] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90544.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90544.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:14] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:14] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=396
[2025-12-09 08:21:14] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:14] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:14] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:14] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:14] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:14] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:15] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539.23', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.23, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539.23', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.23, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:15] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:15] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:15] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539.23', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.23, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90539.23', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90539.23, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:15] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:15] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=397
[2025-12-09 08:21:15] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:15] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:15] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:15] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:15] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:15] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:16] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.95', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.95, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.95', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.95, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:16] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:16] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:16] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.95', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.95, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.95', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.95, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:16] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:16] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=398
[2025-12-09 08:21:16] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:16] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:16] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:16] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:16] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:16] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:18] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.94', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.94, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.94', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.94, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:18] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:18] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:18] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.94', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.94, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.94', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.94, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:18] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:18] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=399
[2025-12-09 08:21:18] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:18] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:18] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:18] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:18] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:18] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:19] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:19] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:19] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:19] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90524.35', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90524.35, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90524.35', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90524.35, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:19] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:19] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=400
[2025-12-09 08:21:19] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:19] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:19] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:19] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:19] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:19] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:21] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90524.28', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90524.28, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90524.28', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90524.28, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:21] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:21] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:21] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90524.28', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90524.28, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90524.28', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90524.28, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:21] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:21] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=401
[2025-12-09 08:21:21] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:21] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:21] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:21] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:21] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:21] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:22] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90525.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90525.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90525.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90525.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:22] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:22] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:22] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90525.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90525.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90525.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90525.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:22] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:22] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=402
[2025-12-09 08:21:22] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:22] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:22] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:22] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:22] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:22] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:24] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90529.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90529.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90529.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90529.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:24] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:24] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:24] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90529.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90529.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90529.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90529.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:24] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:24] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=403
[2025-12-09 08:21:24] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:24] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:24] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:24] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:24] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:24] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:25] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90529.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90529.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90529.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90529.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:25] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:25] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:25] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90529.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90529.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90529.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90529.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:25] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:25] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=404
[2025-12-09 08:21:25] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:25] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:25] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:25] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:25] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:25] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:27] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90529.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90529.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90529.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90529.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:27] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:27] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:27] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90529.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90529.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90529.9', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90529.9, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:27] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:27] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=405
[2025-12-09 08:21:27] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:27] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:27] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:27] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:27] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:27] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:28] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90529.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90529.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90529.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90529.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:28] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:28] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:28] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90529.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90529.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90529.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90529.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:28] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:28] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=406
[2025-12-09 08:21:28] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:28] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:28] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:28] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:28] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:28] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:29] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90530.72', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90530.72, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90530.72', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90530.72, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:29] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:29] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:30] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90530.72', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90530.72, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90530.72', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90530.72, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:30] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:30] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=407
[2025-12-09 08:21:30] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:30] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:30] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:30] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:30] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:30] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:31] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90530.74', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90530.74, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90530.74', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90530.74, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:31] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:31] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:31] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90530.74', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90530.74, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90530.74', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90530.74, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:31] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:31] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=408
[2025-12-09 08:21:31] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:31] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:31] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:31] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:31] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:31] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:32] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90532.63', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90532.63, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90532.63', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90532.63, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:32] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:32] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:32] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90532.63', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90532.63, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90532.63', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90532.63, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:32] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:32] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=409
[2025-12-09 08:21:32] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:32] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:32] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:32] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:32] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:32] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:34] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90532.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90532.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90532.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90532.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:34] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:34] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:34] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90532.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90532.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90532.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90532.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:34] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:34] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=410
[2025-12-09 08:21:34] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:34] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:34] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:34] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:34] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:34] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:35] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:35] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:35] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:35] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:35] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:35] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=411
[2025-12-09 08:21:35] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:35] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:35] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:35] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:35] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:35] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:37] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:37] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:37] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:37] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:37] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:37] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=412
[2025-12-09 08:21:37] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:37] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:37] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:37] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:37] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:37] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:38] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:38] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:38] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:38] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:38] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:38] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=413
[2025-12-09 08:21:38] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:38] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:38] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:38] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:38] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:38] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:40] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:40] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:40] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:40] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:40] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:40] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=414
[2025-12-09 08:21:40] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:40] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:40] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:40] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:40] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:40] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:41] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:41] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:41] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:41] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:41] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:41] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=415
[2025-12-09 08:21:41] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:41] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:41] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:41] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:41] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:41] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:42] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:42] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:43] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:43] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:43] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:43] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=416
[2025-12-09 08:21:43] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:43] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:43] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:43] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:43] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:43] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:44] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:44] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:44] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:44] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:44] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:44] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=417
[2025-12-09 08:21:44] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:44] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:44] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:44] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:44] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:44] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:45] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:45] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:45] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:46] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:46] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:46] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=418
[2025-12-09 08:21:46] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:46] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:46] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:46] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:46] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:46] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:47] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:47] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:47] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:47] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:47] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:47] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=419
[2025-12-09 08:21:47] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:47] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:47] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:47] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:47] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:47] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:48] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:48] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:48] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:48] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90538.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90538.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:48] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:48] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=420
[2025-12-09 08:21:48] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:48] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:48] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:48] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:48] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:48] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:50] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.46', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.46, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.46', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.46, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:50] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:50] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:50] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.46', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.46, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.46', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.46, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:50] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:50] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=421
[2025-12-09 08:21:50] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:50] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:50] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:50] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:50] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:50] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:51] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.34', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.34, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.34', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.34, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:51] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:51] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:51] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.34', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.34, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90537.34', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90537.34, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:51] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:51] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=422
[2025-12-09 08:21:51] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:51] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:51] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:51] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:51] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:51] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:53] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:53] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:53] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:53] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90528', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90528.0, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:53] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:53] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=423
[2025-12-09 08:21:53] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:53] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:53] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:53] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:53] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:53] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:54] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.94', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.94, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.94', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.94, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:54] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:54] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:54] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.09', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.09, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.09', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.09, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:54] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:54] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=424
[2025-12-09 08:21:54] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:54] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:54] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:54] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:54] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:54] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:56] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.01', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.01, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.01', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.01, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:56] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:56] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:56] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.01', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.01, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90523.01', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90523.01, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:56] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:56] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=425
[2025-12-09 08:21:56] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:56] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:56] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:56] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:56] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:56] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:57] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90522.91', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90522.91, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90522.91', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90522.91, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:57] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:57] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:57] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90522.91', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90522.91, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90522.91', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90522.91, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:57] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:57] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=426
[2025-12-09 08:21:57] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:57] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:57] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:57] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:57] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:57] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:21:59] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90522.24', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90522.24, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90522.24', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90522.24, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:59] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:59] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:59] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90522.24', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90522.24, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90522.24', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90522.24, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:21:59] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:21:59] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=427
[2025-12-09 08:21:59] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:21:59] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:21:59] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:21:59] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:21:59] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:21:59] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:22:00] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90522.18', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90522.18, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90522.18', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90522.18, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:00] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:00] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:00] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90522.18', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90522.18, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90522.18', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90522.18, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:00] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:00] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=428
[2025-12-09 08:22:00] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:00] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:22:00] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:22:00] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:22:00] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:22:00] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:22:01] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90521.93', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90521.93, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90521.93', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90521.93, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:01] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:01] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:02] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90521.93', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90521.93, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90521.93', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90521.93, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:02] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:02] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=429
[2025-12-09 08:22:02] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:02] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:22:02] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:22:02] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:22:02] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:22:02] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:22:03] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90512.69', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90512.69, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90512.69', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90512.69, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:03] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:03] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:03] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90512.69', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90512.69, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90512.69', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90512.69, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:03] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:03] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=430
[2025-12-09 08:22:03] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:03] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:22:03] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:22:03] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:22:03] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:22:03] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:22:04] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90512.47', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90512.47, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90512.47', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90512.47, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:04] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:04] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:04] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90512.47', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90512.47, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90512.47', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90512.47, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:04] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:04] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=431
[2025-12-09 08:22:04] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:04] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:22:04] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:22:04] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:22:04] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:22:04] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:22:06] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90512.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90512.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90512.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90512.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:06] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:06] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:06] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90512.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90512.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90512.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90512.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:06] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:06] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=432
[2025-12-09 08:22:06] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:06] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:22:06] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:22:06] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:22:06] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:22:06] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:22:07] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90512.29', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90512.29, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90512.29', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90512.29, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:07] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:07] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:07] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90512.29', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90512.29, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90512.29', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90512.29, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:07] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:07] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=433
[2025-12-09 08:22:07] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:07] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:22:07] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:22:07] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:22:07] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:22:07] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:22:09] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90512.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90512.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90512.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90512.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:09] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:09] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:09] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90512.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90512.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90512.1', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90512.1, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:09] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:09] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=434
[2025-12-09 08:22:09] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:09] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:22:09] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:22:09] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:22:09] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:22:09] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:22:10] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90512.59', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90512.59, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90512.59', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90512.59, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:10] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:10] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:10] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90512.59', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90512.59, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90512.59', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90512.59, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:10] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:10] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=435
[2025-12-09 08:22:10] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:10] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:22:10] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:22:10] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:22:10] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:22:10] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:22:12] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90512.51', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90512.51, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90512.51', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90512.51, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:12] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:12] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:12] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90512.51', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90512.51, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90512.51', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90512.51, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:12] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:12] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=436
[2025-12-09 08:22:12] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:12] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:22:12] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:22:12] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:22:12] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:22:12] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:22:13] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90514.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90514.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90514.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90514.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:13] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:13] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:13] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90514.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90514.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90514.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90514.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:13] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:13] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=437
[2025-12-09 08:22:13] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:13] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:22:13] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:22:13] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:22:13] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:22:13] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:22:15] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90514.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90514.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90514.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90514.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:15] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:15] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:15] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90514.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90514.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90514.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90514.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:15] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:15] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=438
[2025-12-09 08:22:15] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:15] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:22:15] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:22:15] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:22:15] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:22:15] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:22:16] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90514.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90514.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90514.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90514.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:16] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:16] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:16] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90514.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90514.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90514.6', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90514.6, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:16] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:16] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=439
[2025-12-09 08:22:16] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:16] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:22:16] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:22:16] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:22:16] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:22:16] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:22:17] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90514.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90514.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90514.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90514.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:17] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:17] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:18] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90514.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90514.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90514.5', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90514.5, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:18] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:18] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=440
[2025-12-09 08:22:18] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:18] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:22:18] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:22:18] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:22:18] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:22:18] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:22:19] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90526.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90526.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90526.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90526.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:19] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:19] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:19] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90526.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90526.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90526.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90526.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:19] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:19] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=441
[2025-12-09 08:22:19] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:19] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:22:19] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:22:19] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:22:19] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:22:19] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:22:20] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90526.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90526.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90526.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90526.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:20] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:20] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:20] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90526.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90526.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90526.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90526.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:20] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:20] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=442
[2025-12-09 08:22:20] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:20] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:22:20] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:22:20] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:22:20] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:22:20] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:22:22] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90526.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90526.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90526.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90526.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:22] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:22] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:22] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90526.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90526.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90526.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90526.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:22] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:22] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=443
[2025-12-09 08:22:22] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:22] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:22:22] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:22:22] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:22:22] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:22:22] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:22:23] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90526.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90526.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90526.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90526.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:23] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:23] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:23] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90526.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90526.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90526.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90526.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:23] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:23] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=444
[2025-12-09 08:22:23] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:23] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:22:23] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:22:23] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:22:23] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:22:23] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:22:25] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90526.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90526.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90526.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90526.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:25] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:25] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:25] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90526.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90526.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90526.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90526.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:25] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:25] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=445
[2025-12-09 08:22:25] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:25] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:22:25] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:22:25] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:22:25] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:22:25] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:22:26] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90526.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90526.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90526.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90526.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:26] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:26] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:26] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90526.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90526.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90526.7', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90526.7, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:26] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:26] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=446
[2025-12-09 08:22:26] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:26] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:22:26] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:22:26] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:22:26] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:22:26] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:22:28] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90522.75', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90522.75, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90522.75', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90522.75, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:28] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:28] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:28] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90522.75', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90522.75, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90522.75', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90522.75, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:22:28] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:22:28] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=447
[2025-12-09 08:22:28] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:22:28] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:22:28] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:22:28] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:22:28] [INFO] grid_logic: [GRID] NEWS/CB Block active ‚Üí Î™®Îì† Grid ÏóîÌä∏Î¶¨/TP Ï∞®Îã® Î∞è Í∏∞Ï°¥ Maker Ï∑®ÏÜå
[2025-12-09 08:22:28] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
