[2025-12-09 08:00:22] [WARNING] exchange_api: [ExchangeAPI] config.SYMBOL=BTC/USDT:USDT Ïù¥ÏßÄÎßå, v10.1 Î™ÖÏÑ∏Ïóê Îî∞Îùº BTCUSDT Î°ú Í≥†Ï†ïÌï©ÎãàÎã§.
[2025-12-09 08:00:22] [WARNING] exchange_api: üß™ [DRY_RUN] Î™®ÎìúÎ°ú ExchangeAPI Ï¥àÍ∏∞Ìôî (Ïã§ Í±∞Îûò ÏóÜÏùå)
[2025-12-09 08:00:22] [WARNING] state_manager: BotState JSON Ïä§ÌÇ§Îßà Ï∞®Ïù¥ Í∞êÏßÄ (missing=set(), extra={'startup_done'}) ‚Üí Ìò∏Ìôò Î™®ÎìúÎ°ú Î°úÎìúÌï©ÎãàÎã§.
[2025-12-09 08:00:22] [INFO] state_manager: BotState Î°úÎìú: mode=NORMAL wave_id=27413 p_center=91702.4 p_gap=206.7389285714285
[2025-12-09 08:00:22] [INFO] escape_config: [escape_config] YAML loaded but no value changes detected.
[2025-12-09 08:00:22] [WARNING] state_manager: BotState JSON Ïä§ÌÇ§Îßà Ï∞®Ïù¥ Í∞êÏßÄ (missing=set(), extra={'startup_done'}) ‚Üí Ìò∏Ìôò Î™®ÎìúÎ°ú Î°úÎìúÌï©ÎãàÎã§.
[2025-12-09 08:00:22] [INFO] state_manager: BotState Î°úÎìú: mode=NORMAL wave_id=27413 p_center=91702.4 p_gap=206.7389285714285
[2025-12-09 08:00:22] [INFO] main_v10: WaveBot v10.1 starting...
[2025-12-09 08:00:22] [INFO] exchange_api: [ExchangeAPI] DRY_RUN - set_leverage_and_mode Ïä§ÌÇµ
[2025-12-09 08:00:22] [INFO] main_v10: WaveBot v10.1 main loop started (interval=1.000s)
[2025-12-09 08:00:24] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90472.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90472.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90472.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90472.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:00:24] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:00:24] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:00:24] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90472.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90472.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90472.8', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90472.8, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:00:24] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:00:24] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=1
[2025-12-09 08:00:24] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:00:24] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:00:25] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90473.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90473.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90473.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90473.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:00:25] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:00:25] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:00:25] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90473.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90473.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90473.4', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90473.4, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:00:25] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:00:25] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=2
[2025-12-09 08:00:25] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:00:25] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:00:25] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:00:25] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:00:25] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:00:26] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90473.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90473.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90473.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90473.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:00:26] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:00:26] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:00:27] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90473.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90473.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90473.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90473.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:00:27] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:00:27] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=3
[2025-12-09 08:00:27] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:00:27] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:00:27] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:00:27] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:00:27] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:00:28] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90473.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90473.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90473.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90473.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:00:28] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:00:28] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:00:28] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90473.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90473.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90473.2', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90473.2, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:00:28] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:00:28] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=4
[2025-12-09 08:00:28] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:00:28] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:00:28] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:00:28] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:00:28] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:00:29] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90473.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90473.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90473.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90473.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:00:29] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:00:29] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:00:29] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90473.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90473.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90473.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90473.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:00:29] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:00:29] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=5
[2025-12-09 08:00:29] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:00:29] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:00:29] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:00:29] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:00:29] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
[2025-12-09 08:00:31] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90473.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90473.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90473.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90473.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:00:31] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:00:31] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:00:31] [INFO] exchange_api: [ExchangeAPI] raw positions: [{'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90473.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-94.15164625', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '1', 'positionIM': '', 'positionMMByMp': '', 'seq': '495358900964', 'updatedTime': '1765265143074', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': '', 'nextPageCursor': 'BTCUSDT%2C1765200361899%2C2'}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765265143074, 'datetime': '2025-12-09T07:25:43.074Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90473.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}, {'info': {'symbol': 'BTCUSDT', 'leverage': '7', 'autoAddMargin': '0', 'avgPrice': '0', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '', 'positionValue': '', 'isReduceOnly': False, 'positionIMByMp': '', 'tpslMode': 'Full', 'riskId': '1', 'trailingStop': '0', 'unrealisedPnl': '', 'markPrice': '90473.3', 'adlRankIndicator': '0', 'cumRealisedPnl': '-102.69471799', 'positionMM': '', 'createdTime': '1764586754060', 'positionIdx': '2', 'positionIM': '', 'positionMMByMp': '', 'seq': '494941382248', 'updatedTime': '1765200361899', 'side': '', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '0', 'size': '0', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '', 'tradeMode': '0', 'sessionAvgPrice': ''}, 'id': None, 'symbol': 'BTC/USDT:USDT', 'timestamp': 1765200361899, 'datetime': '2025-12-08T13:26:01.899Z', 'lastUpdateTimestamp': None, 'initialMargin': None, 'initialMarginPercentage': None, 'maintenanceMargin': None, 'maintenanceMarginPercentage': None, 'entryPrice': None, 'notional': None, 'leverage': 7.0, 'unrealizedPnl': None, 'contracts': 0.0, 'contractSize': 1.0, 'marginRatio': None, 'liquidationPrice': None, 'markPrice': 90473.3, 'lastPrice': None, 'collateral': 0.0, 'marginMode': None, 'side': None, 'percentage': None, 'stopLossPrice': None, 'takeProfitPrice': None}]
[2025-12-09 08:00:31] [INFO] exchange_api: [ExchangeAPI] mapped positions: LONG={qty=0.000000, avg=0.00}, SHORT={qty=0.000000, avg=0.00}
[2025-12-09 08:00:31] [INFO] wave_fsm: [WaveFSM] pos_state: long=0.0000, short=0.0000, hedge=0.0000, flat=True, flat_ticks=6
[2025-12-09 08:00:31] [INFO] exchange_api: [ExchangeAPI] balance snapshot: total=895.93627069, free=895.93627069
[2025-12-09 08:00:31] [INFO] wave_fsm: [Risk] total_balance_snap=600.0000 (DRY_RUN=True, real_balance=895.9363)
[2025-12-09 08:00:31] [ERROR] wave_fsm: [WaveFSM] Wave lifecycle handling failed: 'WaveFSM' object has no attribute 'capital_manager'
Traceback (most recent call last):
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 527, in tick
    self._handle_wave_lifecycle(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 408, in _handle_wave_lifecycle
    self._start_new_wave(feed)
  File "/home/ubuntu/mexc_bot/strategy/wave_fsm.py", line 429, in _start_new_wave
    snap = self.capital_manager.compute_wave_snapshot(total_balance_snap)
           ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'WaveFSM' object has no attribute 'capital_manager'
[2025-12-09 08:00:31] [INFO] grid_logic: [Feed] pos_for_fsm: long=0.000000 short=0.000000 hedge=0.000000 long_pnl=0.000000 short_pnl=0.000000
[2025-12-09 08:00:31] [INFO] order_manager: [OrderManager] apply_decision(mode=NORMAL, cancels=0, entries=0, replaces=0)
